<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 1 2024 CD Report | In-Service Presentation, August 2024</title>
  <meta name="description" content="Section 1 2024 CD Report | In-Service Presentation, August 2024" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 1 2024 CD Report | In-Service Presentation, August 2024" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 1 2024 CD Report | In-Service Presentation, August 2024" />
  
  
  

<meta name="author" content="Alec Higgins" />


<meta name="date" content="2024-08-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="mch-report.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Alec Higgins In-Service Presentation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sections"><i class="fa fa-check"></i>Sections</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="cd-report.html"><a href="cd-report.html"><i class="fa fa-check"></i><b>1</b> 2024 CD Report</a>
<ul>
<li class="chapter" data-level="1.1" data-path="cd-report.html"><a href="cd-report.html#libraries"><i class="fa fa-check"></i><b>1.1</b> Libraries</a></li>
<li class="chapter" data-level="1.2" data-path="cd-report.html"><a href="cd-report.html#settings"><i class="fa fa-check"></i><b>1.2</b> Settings</a></li>
<li class="chapter" data-level="1.3" data-path="cd-report.html"><a href="cd-report.html#reading-data-then-saving"><i class="fa fa-check"></i><b>1.3</b> Reading data, then saving</a></li>
<li class="chapter" data-level="1.4" data-path="cd-report.html"><a href="cd-report.html#combining-and-saving-data"><i class="fa fa-check"></i><b>1.4</b> Combining and saving data</a></li>
<li class="chapter" data-level="1.5" data-path="cd-report.html"><a href="cd-report.html#extracting-and-exporting-demographic-data-from-a-line-list"><i class="fa fa-check"></i><b>1.5</b> Extracting and exporting demographic data from a line list</a></li>
<li class="chapter" data-level="1.6" data-path="cd-report.html"><a href="cd-report.html#tabulating-demographic-data"><i class="fa fa-check"></i><b>1.6</b> Tabulating demographic data</a></li>
<li class="chapter" data-level="1.7" data-path="cd-report.html"><a href="cd-report.html#calculating-incidence-by-zip-code"><i class="fa fa-check"></i><b>1.7</b> Calculating incidence by ZIP code</a></li>
<li class="chapter" data-level="1.8" data-path="cd-report.html"><a href="cd-report.html#generating-counts-and-rates-tables"><i class="fa fa-check"></i><b>1.8</b> Generating counts and rates tables</a></li>
<li class="chapter" data-level="1.9" data-path="cd-report.html"><a href="cd-report.html#final-notes"><i class="fa fa-check"></i><b>1.9</b> Final notes</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="mch-report.html"><a href="mch-report.html"><i class="fa fa-check"></i><b>2</b> 2024 MCH Report</a>
<ul>
<li class="chapter" data-level="2.1" data-path="mch-report.html"><a href="mch-report.html#libraries-1"><i class="fa fa-check"></i><b>2.1</b> Libraries</a></li>
<li class="chapter" data-level="2.2" data-path="mch-report.html"><a href="mch-report.html#transposing-data"><i class="fa fa-check"></i><b>2.2</b> Transposing data</a></li>
<li class="chapter" data-level="2.3" data-path="mch-report.html"><a href="mch-report.html#importing-data"><i class="fa fa-check"></i><b>2.3</b> Importing data</a></li>
<li class="chapter" data-level="2.4" data-path="mch-report.html"><a href="mch-report.html#cleaning-and-combining-data"><i class="fa fa-check"></i><b>2.4</b> Cleaning and combining data</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="mch-report.html"><a href="mch-report.html#prenatal-care-initiation-by-maternal-age"><i class="fa fa-check"></i><b>2.4.1</b> Prenatal care initiation by maternal age</a></li>
<li class="chapter" data-level="2.4.2" data-path="mch-report.html"><a href="mch-report.html#prenatal-care-initiation-by-maternal-education"><i class="fa fa-check"></i><b>2.4.2</b> Prenatal care initiation by maternal education</a></li>
<li class="chapter" data-level="2.4.3" data-path="mch-report.html"><a href="mch-report.html#prenatal-care-initiation-by-marital-status"><i class="fa fa-check"></i><b>2.4.3</b> Prenatal care initiation by marital status</a></li>
<li class="chapter" data-level="2.4.4" data-path="mch-report.html"><a href="mch-report.html#prenatal-care-initiation-by-maternal-race-and-ethnicity"><i class="fa fa-check"></i><b>2.4.4</b> Prenatal care initiation by maternal race and ethnicity</a></li>
<li class="chapter" data-level="2.4.5" data-path="mch-report.html"><a href="mch-report.html#birthweight-by-prenatal-care-initiation"><i class="fa fa-check"></i><b>2.4.5</b> Birthweight by prenatal care initiation</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="mch-report.html"><a href="mch-report.html#exporting-data"><i class="fa fa-check"></i><b>2.5</b> Exporting data</a></li>
<li class="chapter" data-level="2.6" data-path="mch-report.html"><a href="mch-report.html#graphing-data"><i class="fa fa-check"></i><b>2.6</b> Graphing data</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="mch-report.html"><a href="mch-report.html#prenatal-care-initiation-by-maternal-age-1"><i class="fa fa-check"></i><b>2.6.1</b> Prenatal care initiation by maternal age</a></li>
<li class="chapter" data-level="2.6.2" data-path="mch-report.html"><a href="mch-report.html#prenatal-care-initiation-by-maternal-education-1"><i class="fa fa-check"></i><b>2.6.2</b> Prenatal care initiation by maternal education</a></li>
<li class="chapter" data-level="2.6.3" data-path="mch-report.html"><a href="mch-report.html#prenatal-care-initiation-by-marital-status-1"><i class="fa fa-check"></i><b>2.6.3</b> Prenatal care initiation by marital status</a></li>
<li class="chapter" data-level="2.6.4" data-path="mch-report.html"><a href="mch-report.html#prenatal-care-initiation-by-race-and-ethnicity"><i class="fa fa-check"></i><b>2.6.4</b> Prenatal care initiation by race and ethnicity</a></li>
<li class="chapter" data-level="2.6.5" data-path="mch-report.html"><a href="mch-report.html#birthweight-by-prenatal-care-initiation-1"><i class="fa fa-check"></i><b>2.6.5</b> Birthweight by prenatal care initiation</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="mch-report.html"><a href="mch-report.html#calculating-risk-ratios-for-early-prenatal-care"><i class="fa fa-check"></i><b>2.7</b> Calculating risk ratios for early prenatal care</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="mch-report.html"><a href="mch-report.html#risk-of-prenatal-care-initiation-by-maternal-age"><i class="fa fa-check"></i><b>2.7.1</b> Risk of prenatal care initiation by maternal age</a></li>
<li class="chapter" data-level="2.7.2" data-path="mch-report.html"><a href="mch-report.html#risk-of-prenatal-care-initiation-by-maternal-education"><i class="fa fa-check"></i><b>2.7.2</b> Risk of prenatal care initiation by maternal education</a></li>
<li class="chapter" data-level="2.7.3" data-path="mch-report.html"><a href="mch-report.html#risk-of-prenatal-care-initiation-by-marital-status"><i class="fa fa-check"></i><b>2.7.3</b> Risk of prenatal care initiation by marital status</a></li>
<li class="chapter" data-level="2.7.4" data-path="mch-report.html"><a href="mch-report.html#risk-of-prenatal-care-initiation-by-race-and-ethnicity"><i class="fa fa-check"></i><b>2.7.4</b> Risk of prenatal care initiation by race and ethnicity</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="mch-report.html"><a href="mch-report.html#final-notes-1"><i class="fa fa-check"></i><b>2.8</b> Final notes</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="stis.html"><a href="stis.html"><i class="fa fa-check"></i><b>3</b> STIs</a>
<ul>
<li class="chapter" data-level="3.1" data-path="stis.html"><a href="stis.html#libraries-2"><i class="fa fa-check"></i><b>3.1</b> Libraries</a></li>
<li class="chapter" data-level="3.2" data-path="stis.html"><a href="stis.html#importing-chlamydia-data"><i class="fa fa-check"></i><b>3.2</b> Importing chlamydia data</a></li>
<li class="chapter" data-level="3.3" data-path="stis.html"><a href="stis.html#filtering-data-to-exclude-non-wake-cases"><i class="fa fa-check"></i><b>3.3</b> Filtering data to exclude non-Wake cases</a></li>
<li class="chapter" data-level="3.4" data-path="stis.html"><a href="stis.html#loading-census-data"><i class="fa fa-check"></i><b>3.4</b> Loading census data</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="stis.html"><a href="stis.html#loading-age-data"><i class="fa fa-check"></i><b>3.4.1</b> Loading age data</a></li>
<li class="chapter" data-level="3.4.2" data-path="stis.html"><a href="stis.html#loading-race-and-ethnicity-data"><i class="fa fa-check"></i><b>3.4.2</b> Loading race and ethnicity data</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="stis.html"><a href="stis.html#tally-cases-by-group-and-calculate-incidence"><i class="fa fa-check"></i><b>3.5</b> Tally cases by group and calculate incidence</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="stis.html"><a href="stis.html#chlamydia-incidence-by-age-group"><i class="fa fa-check"></i><b>3.5.1</b> Chlamydia incidence by age group</a></li>
<li class="chapter" data-level="3.5.2" data-path="stis.html"><a href="stis.html#chlamydia-incidence-by-race"><i class="fa fa-check"></i><b>3.5.2</b> Chlamydia incidence by race</a></li>
<li class="chapter" data-level="3.5.3" data-path="stis.html"><a href="stis.html#chlamydia-count-by-municipality"><i class="fa fa-check"></i><b>3.5.3</b> Chlamydia count by municipality</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="stis.html"><a href="stis.html#graphing-chlamydia"><i class="fa fa-check"></i><b>3.6</b> Graphing chlamydia</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="stis.html"><a href="stis.html#chlamydia-incidence-by-age-group-1"><i class="fa fa-check"></i><b>3.6.1</b> Chlamydia incidence by age group</a></li>
<li class="chapter" data-level="3.6.2" data-path="stis.html"><a href="stis.html#chlamydia-incidence-by-race-1"><i class="fa fa-check"></i><b>3.6.2</b> Chlamydia incidence by race</a></li>
<li class="chapter" data-level="3.6.3" data-path="stis.html"><a href="stis.html#chlamydia-count-by-municipality-1"><i class="fa fa-check"></i><b>3.6.3</b> Chlamydia count by municipality</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="stis.html"><a href="stis.html#tallying-and-graphing-gonorrhea"><i class="fa fa-check"></i><b>3.7</b> Tallying and graphing gonorrhea</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="stis.html"><a href="stis.html#importing"><i class="fa fa-check"></i><b>3.7.1</b> Importing</a></li>
<li class="chapter" data-level="3.7.2" data-path="stis.html"><a href="stis.html#filtering"><i class="fa fa-check"></i><b>3.7.2</b> Filtering</a></li>
<li class="chapter" data-level="3.7.3" data-path="stis.html"><a href="stis.html#tallying"><i class="fa fa-check"></i><b>3.7.3</b> Tallying</a></li>
<li class="chapter" data-level="3.7.4" data-path="stis.html"><a href="stis.html#graphing-gonorrhea-incidence-by-age-group"><i class="fa fa-check"></i><b>3.7.4</b> Graphing gonorrhea incidence by age group</a></li>
<li class="chapter" data-level="3.7.5" data-path="stis.html"><a href="stis.html#graphing-gonorrhea-incidence-by-race"><i class="fa fa-check"></i><b>3.7.5</b> Graphing gonorrhea incidence by race</a></li>
<li class="chapter" data-level="3.7.6" data-path="stis.html"><a href="stis.html#graphing-gonorrhea-count-by-municipality"><i class="fa fa-check"></i><b>3.7.6</b> Graphing gonorrhea count by municipality</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="stis.html"><a href="stis.html#final-notes-2"><i class="fa fa-check"></i><b>3.8</b> Final notes</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html"><i class="fa fa-check"></i><b>4</b> Respiratory Viruses</a>
<ul>
<li class="chapter" data-level="4.1" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#header-content"><i class="fa fa-check"></i><b>4.1</b> Header content</a></li>
<li class="chapter" data-level="4.2" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#settings-and-setup"><i class="fa fa-check"></i><b>4.2</b> Settings and setup</a></li>
<li class="chapter" data-level="4.3" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#importing-data-1"><i class="fa fa-check"></i><b>4.3</b> Importing data</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#factors"><i class="fa fa-check"></i><b>4.3.1</b> Factors</a></li>
<li class="chapter" data-level="4.3.2" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#modifying-the-epi-year"><i class="fa fa-check"></i><b>4.3.2</b> Modifying the epi year</a></li>
<li class="chapter" data-level="4.3.3" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#reading-the-files"><i class="fa fa-check"></i><b>4.3.3</b> Reading the files</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#highlights-slide"><i class="fa fa-check"></i><b>4.4</b> Highlights slide</a></li>
<li class="chapter" data-level="4.5" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#graphing"><i class="fa fa-check"></i><b>4.5</b> Graphing</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#ili-counts-by-week"><i class="fa fa-check"></i><b>4.5.1</b> ILI counts by week</a></li>
<li class="chapter" data-level="4.5.2" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#ili-counts-by-age-group"><i class="fa fa-check"></i><b>4.5.2</b> ILI counts by age group</a></li>
<li class="chapter" data-level="4.5.3" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#ili-proportions-by-age-group"><i class="fa fa-check"></i><b>4.5.3</b> ILI proportions by age group</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#rendering-and-formatting"><i class="fa fa-check"></i><b>4.6</b> Rendering and formatting</a></li>
<li class="chapter" data-level="4.7" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#final-notes-3"><i class="fa fa-check"></i><b>4.7</b> Final notes</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bookdown.html"><a href="bookdown.html"><i class="fa fa-check"></i><b>5</b> Bookdown</a>
<ul>
<li class="chapter" data-level="5.1" data-path="bookdown.html"><a href="bookdown.html#file-structure"><i class="fa fa-check"></i><b>5.1</b> File structure</a></li>
<li class="chapter" data-level="5.2" data-path="bookdown.html"><a href="bookdown.html#bookdown-package"><i class="fa fa-check"></i><b>5.2</b> Bookdown package</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Created with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">In-Service Presentation, August 2024</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cd-report" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">Section 1</span> 2024 CD Report<a href="cd-report.html#cd-report" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>WCHHS publishes an annual Communicable Disease Report, which displays trends, demographics, and key insights for the top 10 communicable diseases and includes spotlight sections to explain the role of public health, prevention topics, and intervention programs in Wake County.</p>
<p>For this report, I contributed data analysis, graphics, and several tables. The graphics were produced in Microsoft Excel. The R code used to manage and tidy the data and to generate the table are shown below.</p>
<p>We will start by going through the <code>import.R</code> script, then look through the other two scripts and the table-generating R Markdown file.</p>
<div id="libraries" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Libraries<a href="cd-report.html#libraries" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="cd-report.html#cb1-1" tabindex="-1"></a><span class="co"># Libraries</span></span>
<span id="cb1-2"><a href="cd-report.html#cb1-2" tabindex="-1"></a><span class="co"># These commands must be run first!</span></span>
<span id="cb1-3"><a href="cd-report.html#cb1-3" tabindex="-1"></a><span class="co"># Highlight them and press Ctrl + Enter (Cmd + Enter on Mac)</span></span>
<span id="cb1-4"><a href="cd-report.html#cb1-4" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-5"><a href="cd-report.html#cb1-5" tabindex="-1"></a><span class="fu">library</span>(readxl)</span></code></pre></div>
<p>There are two non-standard libraries used in these scripts.</p>
<ol style="list-style-type: decimal">
<li><code>tidyverse</code>: The tidyverse is a set of packages with a common syntax and philosophy. It includes many useful packages, such as <code>dplyr</code> (which provides many data management functions) and <code>ggplot2</code> (which is used to create all graphics in this presentation).</li>
<li><code>readxl</code>: This package provides functions that read Microsoft Excel files.</li>
</ol>
</div>
<div id="settings" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Settings<a href="cd-report.html#settings" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="cd-report.html#cb2-1" tabindex="-1"></a><span class="co"># Settings</span></span>
<span id="cb2-2"><a href="cd-report.html#cb2-2" tabindex="-1"></a><span class="do">## Set the years of interest for this report here:</span></span>
<span id="cb2-3"><a href="cd-report.html#cb2-3" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">2023</span>, <span class="dv">2022</span>, <span class="dv">2021</span>, <span class="dv">2020</span>, <span class="dv">2019</span>)</span>
<span id="cb2-4"><a href="cd-report.html#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="cd-report.html#cb2-5" tabindex="-1"></a><span class="co"># Functions</span></span>
<span id="cb2-6"><a href="cd-report.html#cb2-6" tabindex="-1"></a><span class="do">## Function to implement year setting</span></span>
<span id="cb2-7"><a href="cd-report.html#cb2-7" tabindex="-1"></a>sesh_cyear <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">paste0</span>(<span class="st">&quot;c&quot;</span>, x)}</span>
<span id="cb2-8"><a href="cd-report.html#cb2-8" tabindex="-1"></a>sesh_ryear <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">paste0</span>(<span class="st">&quot;r&quot;</span>, x)}</span></code></pre></div>
<p>A list of years of interest and two simple functions are created here. Note a few things:</p>
<ol style="list-style-type: decimal">
<li>The lines beginning with <code>#</code>, which are comments and are not run.</li>
<li><code>&lt;-</code>: The assignment arrow in the first expression, which says <em>define <code>years</code> to be a list with values <code>2023</code>, <code>2022</code>, …</em>.</li>
<li><code>function(x){...}</code>: These lines assign a function with one argument (<code>x</code>) to <code>sesh_cyear</code> and <code>sesh_ryear</code>. These functions are very simple: they paste a letter (c or r) in front of the argument and output it. We’ll see why this is used soon.</li>
</ol>
<p>As a note: When writing your own functions, the names are entirely up to you. However, it is best practice to avoid writing a function and giving it the same name as another function in a package you’re using. I use the <code>sesh_</code> prefix to avoid overwriting any pre-existing functions, but that’s my own convention.</p>
</div>
<div id="reading-data-then-saving" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> Reading data, then saving<a href="cd-report.html#reading-data-then-saving" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="cd-report.html#cb3-1" tabindex="-1"></a><span class="do">## Read and save in R preferred format</span></span>
<span id="cb3-2"><a href="cd-report.html#cb3-2" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="st">&quot;Tables/Notifiables.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="cd-report.html#cb3-3" tabindex="-1"></a>  <span class="fu">saveRDS</span>(<span class="at">file =</span> <span class="st">&quot;Tables/notifiables.rds&quot;</span>)</span>
<span id="cb3-4"><a href="cd-report.html#cb3-4" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="st">&quot;Tables/NCNotifiables.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="cd-report.html#cb3-5" tabindex="-1"></a>  <span class="fu">saveRDS</span>(<span class="st">&quot;Tables/ncnotifiables.rds&quot;</span>)</span></code></pre></div>
<p>These lines read a .csv file with data, then save it as a .rds file, which is a standard R format that can be read faster and more easily than spreadsheets. Notice:</p>
<ol style="list-style-type: decimal">
<li><code>read_csv()</code>: This reads the specified .csv file.</li>
<li><code>saveRDS()</code>: This saves the data specified as a .rds file.</li>
<li><em>Pipe</em> <code>%&gt;%</code>: The pipe is a shorthand function that takes the output of the function before it and inserts it as the first argument in the next line. Alternatively, these lines could be written:</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="cd-report.html#cb4-1" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb4-2"><a href="cd-report.html#cb4-2" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="st">&quot;Tables/Notifiables.csv&quot;</span>),</span>
<span id="cb4-3"><a href="cd-report.html#cb4-3" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;Tables/notifiables.rds&quot;</span></span>
<span id="cb4-4"><a href="cd-report.html#cb4-4" tabindex="-1"></a>)</span>
<span id="cb4-5"><a href="cd-report.html#cb4-5" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb4-6"><a href="cd-report.html#cb4-6" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="st">&quot;Tables/NCNotifiables.csv&quot;</span>),</span>
<span id="cb4-7"><a href="cd-report.html#cb4-7" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;Tables/ncnotifiables.rds&quot;</span></span>
<span id="cb4-8"><a href="cd-report.html#cb4-8" tabindex="-1"></a>)</span></code></pre></div>
<p>While both options perform the same task, the first is more logical. This becomes important when you want to string several steps together: the pipe allows you to order functions in the order you want to perform them rather than nesting the first step within each of the following steps.</p>
</div>
<div id="combining-and-saving-data" class="section level2 hasAnchor" number="1.4">
<h2><span class="header-section-number">1.4</span> Combining and saving data<a href="cd-report.html#combining-and-saving-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>First, we define two functions to read the data we just saved. This will save a few keystrokes as we go. You’ll notice there are no arguments specified, because we do not need any: we just want to have a shorthand way of saying “read the <code>notif</code> data” and “read the <code>ncnotif</code> data”.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="cd-report.html#cb5-1" tabindex="-1"></a>notif <span class="ot">&lt;-</span> <span class="cf">function</span>(){<span class="fu">readRDS</span>(<span class="st">&quot;Tables/notifiables.rds&quot;</span>)}</span>
<span id="cb5-2"><a href="cd-report.html#cb5-2" tabindex="-1"></a>ncnotif <span class="ot">&lt;-</span> <span class="cf">function</span>(){<span class="fu">readRDS</span>(<span class="st">&quot;Tables/ncnotifiables.rds&quot;</span>)}</span></code></pre></div>
<p>Next, we actually read in the data, manipulate it to make it easier to combine, combine it with other data, pivot it to be more readable again, and save it to a .csv file for use later. Look for the comments within to explain the code.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="cd-report.html#cb6-1" tabindex="-1"></a><span class="co"># Join the Wake County notifiables data with the North Carolina notifiables data.</span></span>
<span id="cb6-2"><a href="cd-report.html#cb6-2" tabindex="-1"></a><span class="fu">full_join</span>(</span>
<span id="cb6-3"><a href="cd-report.html#cb6-3" tabindex="-1"></a>  </span>
<span id="cb6-4"><a href="cd-report.html#cb6-4" tabindex="-1"></a>  <span class="co"># Join the Wake County counts with the Wake County rates.</span></span>
<span id="cb6-5"><a href="cd-report.html#cb6-5" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb6-6"><a href="cd-report.html#cb6-6" tabindex="-1"></a>    <span class="fu">pivot_longer</span>( <span class="do">## Condense the counts by year columns.</span></span>
<span id="cb6-7"><a href="cd-report.html#cb6-7" tabindex="-1"></a>      <span class="fu">notif</span>(),    <span class="do">## Read in the Wake County data.</span></span>
<span id="cb6-8"><a href="cd-report.html#cb6-8" tabindex="-1"></a>      <span class="at">cols =</span> years <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="cd-report.html#cb6-9" tabindex="-1"></a>        <span class="fu">lapply</span>(sesh_cyear) <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="cd-report.html#cb6-10" tabindex="-1"></a>        <span class="fu">unlist</span>(), <span class="do">## Insert a &quot;c&quot; before the year for count columns.</span></span>
<span id="cb6-11"><a href="cd-report.html#cb6-11" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">&quot;cyear&quot;</span>,</span>
<span id="cb6-12"><a href="cd-report.html#cb6-12" tabindex="-1"></a>      <span class="at">values_to =</span> <span class="st">&quot;cases&quot;</span></span>
<span id="cb6-13"><a href="cd-report.html#cb6-13" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-14"><a href="cd-report.html#cb6-14" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(cyear, <span class="st">&quot;c&quot;</span>))), <span class="do">## Remove the &quot;c&quot; and make the year a number.</span></span>
<span id="cb6-15"><a href="cd-report.html#cb6-15" tabindex="-1"></a>    </span>
<span id="cb6-16"><a href="cd-report.html#cb6-16" tabindex="-1"></a>    <span class="fu">pivot_longer</span>( <span class="do">## Repeat, but for rates.</span></span>
<span id="cb6-17"><a href="cd-report.html#cb6-17" tabindex="-1"></a>      <span class="fu">notif</span>(),</span>
<span id="cb6-18"><a href="cd-report.html#cb6-18" tabindex="-1"></a>      <span class="at">cols =</span> years <span class="sc">%&gt;%</span> </span>
<span id="cb6-19"><a href="cd-report.html#cb6-19" tabindex="-1"></a>        <span class="fu">lapply</span>(sesh_ryear) <span class="sc">%&gt;%</span> </span>
<span id="cb6-20"><a href="cd-report.html#cb6-20" tabindex="-1"></a>        <span class="fu">unlist</span>(),</span>
<span id="cb6-21"><a href="cd-report.html#cb6-21" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">&quot;ryear&quot;</span>,</span>
<span id="cb6-22"><a href="cd-report.html#cb6-22" tabindex="-1"></a>      <span class="at">values_to =</span> <span class="st">&quot;rate&quot;</span></span>
<span id="cb6-23"><a href="cd-report.html#cb6-23" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-24"><a href="cd-report.html#cb6-24" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(ryear, <span class="st">&quot;r&quot;</span>))),</span>
<span id="cb6-25"><a href="cd-report.html#cb6-25" tabindex="-1"></a>    </span>
<span id="cb6-26"><a href="cd-report.html#cb6-26" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">join_by</span>(disease, year) <span class="do">## Merge counts/rates by disease name and year.</span></span>
<span id="cb6-27"><a href="cd-report.html#cb6-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-28"><a href="cd-report.html#cb6-28" tabindex="-1"></a>    </span>
<span id="cb6-29"><a href="cd-report.html#cb6-29" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">loc =</span> <span class="st">&quot;Wake County&quot;</span>) <span class="sc">%&gt;%</span> <span class="do">## Specify these are Wake numbers.</span></span>
<span id="cb6-30"><a href="cd-report.html#cb6-30" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">c</span>(disease, year, loc, cases, rate)), <span class="do">## Delete all but five columns.</span></span>
<span id="cb6-31"><a href="cd-report.html#cb6-31" tabindex="-1"></a>  </span>
<span id="cb6-32"><a href="cd-report.html#cb6-32" tabindex="-1"></a>  <span class="co"># Join the North Carolina counts with the North Carolina rates.</span></span>
<span id="cb6-33"><a href="cd-report.html#cb6-33" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb6-34"><a href="cd-report.html#cb6-34" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb6-35"><a href="cd-report.html#cb6-35" tabindex="-1"></a>      <span class="fu">ncnotif</span>(),</span>
<span id="cb6-36"><a href="cd-report.html#cb6-36" tabindex="-1"></a>      <span class="at">cols =</span> years <span class="sc">%&gt;%</span> </span>
<span id="cb6-37"><a href="cd-report.html#cb6-37" tabindex="-1"></a>        <span class="fu">lapply</span>(sesh_cyear) <span class="sc">%&gt;%</span> </span>
<span id="cb6-38"><a href="cd-report.html#cb6-38" tabindex="-1"></a>        <span class="fu">unlist</span>(),</span>
<span id="cb6-39"><a href="cd-report.html#cb6-39" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">&quot;cyear&quot;</span>,</span>
<span id="cb6-40"><a href="cd-report.html#cb6-40" tabindex="-1"></a>      <span class="at">values_to =</span> <span class="st">&quot;cases&quot;</span></span>
<span id="cb6-41"><a href="cd-report.html#cb6-41" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-42"><a href="cd-report.html#cb6-42" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(cyear, <span class="st">&quot;c&quot;</span>))),</span>
<span id="cb6-43"><a href="cd-report.html#cb6-43" tabindex="-1"></a>    </span>
<span id="cb6-44"><a href="cd-report.html#cb6-44" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb6-45"><a href="cd-report.html#cb6-45" tabindex="-1"></a>      <span class="fu">ncnotif</span>(),</span>
<span id="cb6-46"><a href="cd-report.html#cb6-46" tabindex="-1"></a>      <span class="at">cols =</span> years <span class="sc">%&gt;%</span> </span>
<span id="cb6-47"><a href="cd-report.html#cb6-47" tabindex="-1"></a>        <span class="fu">lapply</span>(sesh_ryear) <span class="sc">%&gt;%</span> </span>
<span id="cb6-48"><a href="cd-report.html#cb6-48" tabindex="-1"></a>        <span class="fu">unlist</span>(),</span>
<span id="cb6-49"><a href="cd-report.html#cb6-49" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">&quot;ryear&quot;</span>,</span>
<span id="cb6-50"><a href="cd-report.html#cb6-50" tabindex="-1"></a>      <span class="at">values_to =</span> <span class="st">&quot;rate&quot;</span></span>
<span id="cb6-51"><a href="cd-report.html#cb6-51" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-52"><a href="cd-report.html#cb6-52" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(ryear, <span class="st">&quot;r&quot;</span>))),</span>
<span id="cb6-53"><a href="cd-report.html#cb6-53" tabindex="-1"></a>    </span>
<span id="cb6-54"><a href="cd-report.html#cb6-54" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">join_by</span>(disease, year)</span>
<span id="cb6-55"><a href="cd-report.html#cb6-55" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-56"><a href="cd-report.html#cb6-56" tabindex="-1"></a>    </span>
<span id="cb6-57"><a href="cd-report.html#cb6-57" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">loc =</span> <span class="st">&quot;North Carolina&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-58"><a href="cd-report.html#cb6-58" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">c</span>(disease, year, loc, cases, rate)),</span>
<span id="cb6-59"><a href="cd-report.html#cb6-59" tabindex="-1"></a>  </span>
<span id="cb6-60"><a href="cd-report.html#cb6-60" tabindex="-1"></a>  <span class="fu">join_by</span>(disease, year, loc, cases, rate) <span class="co"># Merge Wake County and NC data with these variables.</span></span>
<span id="cb6-61"><a href="cd-report.html#cb6-61" tabindex="-1"></a>  </span>
<span id="cb6-62"><a href="cd-report.html#cb6-62" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="co"># The Wake and NC notifiables data are piped ahead here.</span></span>
<span id="cb6-63"><a href="cd-report.html#cb6-63" tabindex="-1"></a>      <span class="co"># This is the end of the first full_join.</span></span>
<span id="cb6-64"><a href="cd-report.html#cb6-64" tabindex="-1"></a>  </span>
<span id="cb6-65"><a href="cd-report.html#cb6-65" tabindex="-1"></a>  <span class="co"># Split the Wake and NC data into two columns.</span></span>
<span id="cb6-66"><a href="cd-report.html#cb6-66" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb6-67"><a href="cd-report.html#cb6-67" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(disease, year),</span>
<span id="cb6-68"><a href="cd-report.html#cb6-68" tabindex="-1"></a>    <span class="at">names_from =</span> loc,</span>
<span id="cb6-69"><a href="cd-report.html#cb6-69" tabindex="-1"></a>    <span class="at">values_from =</span> rate</span>
<span id="cb6-70"><a href="cd-report.html#cb6-70" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-71"><a href="cd-report.html#cb6-71" tabindex="-1"></a>  </span>
<span id="cb6-72"><a href="cd-report.html#cb6-72" tabindex="-1"></a>  <span class="co"># Save the new data to a .csv file.</span></span>
<span id="cb6-73"><a href="cd-report.html#cb6-73" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&quot;Products/Counts/all.csv&quot;</span>, <span class="at">na =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p>Here are the steps performed above:</p>
<ol style="list-style-type: decimal">
<li>Separately, select counts columns and rates columns from Notifiables.rds and NCNotifiables.rds.</li>
<li><em>Pivot</em> them, so columns named by year become year values in a “Year” column, with new “Counts” and “Rates” columns for their data. This creates more rows than there originally were.</li>
<li><em>Join</em> the counts and rates tables, so they appear in the same table.</li>
<li><em>Mutate</em>, or add, a location column in each, specifying whether the values apply to Wake County or North Carolina.</li>
<li><em>Join</em> the Wake County and North Carolina tables, so they appear in the same table.</li>
<li><em>Pivot</em> the combined table, so there are rates columns by location containing yearly values.</li>
<li>Save the combined data as a .csv file.</li>
</ol>
</div>
<div id="extracting-and-exporting-demographic-data-from-a-line-list" class="section level2 hasAnchor" number="1.5">
<h2><span class="header-section-number">1.5</span> Extracting and exporting demographic data from a line list<a href="cd-report.html#extracting-and-exporting-demographic-data-from-a-line-list" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The final section of the <code>import.R</code> script takes line lists (for foodborne, vaccine-preventable, vector-borne, and sexually transmitted illnesses), extracts the columns with age, sex, race, ethnicity, and ZIP code data, and exports them to a separate file for analysis later.</p>
<p>First, we need to write a function that automates the selection of just those five columns from the data. Here, that function is <code>sesh_caseimport</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="cd-report.html#cb7-1" tabindex="-1"></a><span class="do">## function to automate selection of key demographic data</span></span>
<span id="cb7-2"><a href="cd-report.html#cb7-2" tabindex="-1"></a>sesh_caseimport <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb7-3"><a href="cd-report.html#cb7-3" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb7-4"><a href="cd-report.html#cb7-4" tabindex="-1"></a>    <span class="at">age =</span> <span class="fu">unlist</span>(x[<span class="fu">str_detect</span>(<span class="fu">names</span>(x), <span class="st">&quot;Age&quot;</span>)]),</span>
<span id="cb7-5"><a href="cd-report.html#cb7-5" tabindex="-1"></a>    <span class="at">gender =</span> <span class="fu">unlist</span>(x[<span class="fu">str_detect</span>(<span class="fu">names</span>(x), <span class="st">&quot;Gender&quot;</span>)]),</span>
<span id="cb7-6"><a href="cd-report.html#cb7-6" tabindex="-1"></a>    <span class="at">race =</span> <span class="fu">unlist</span>(x[<span class="fu">str_detect</span>(<span class="fu">names</span>(x), <span class="st">&quot;Race&quot;</span>)]),</span>
<span id="cb7-7"><a href="cd-report.html#cb7-7" tabindex="-1"></a>    <span class="at">hisp =</span> <span class="fu">unlist</span>(x[<span class="fu">str_detect</span>(<span class="fu">names</span>(x), <span class="st">&quot;Hispanic&quot;</span>)]),</span>
<span id="cb7-8"><a href="cd-report.html#cb7-8" tabindex="-1"></a>    <span class="at">zip =</span> <span class="fu">unlist</span>(x[<span class="fu">str_detect</span>(<span class="fu">names</span>(x), <span class="fu">coll</span>(<span class="st">&quot;ZIP&quot;</span>,</span>
<span id="cb7-9"><a href="cd-report.html#cb7-9" tabindex="-1"></a>                                             <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))])</span>
<span id="cb7-10"><a href="cd-report.html#cb7-10" tabindex="-1"></a>  )</span></code></pre></div>
<p>This function creates a specific kind of table (a <em>tibble</em>, which is a <code>tidyverse</code> object) with five columns, one each for the five data points we want to extract from each case. For each column, we:</p>
<ol style="list-style-type: decimal">
<li>Use <code>str_detect()</code> to search the column headers, provided by <code>names()</code>, for five keywords. This ensures that if the column headers change between years or line lists, the same script will still work.</li>
<li><em>Subset</em> (select) the matching column from the original dataset using <code>x[]</code> syntax.</li>
<li><em>Unlist</em> the column found in the original, converting it to a standard <em>vector</em> (column in a dataset).</li>
<li>Name the columns something standard. Here, those names are <em>age</em>, <em>gender</em>, <em>race</em>, <em>hisp</em>, and <em>zip</em>.</li>
</ol>
<p>For the ZIP code, we use <code>coll()</code> with the <code>ignore_case = TRUE</code> option so that the script will select “ZIP Code”, “Zip Code”, “zip code”, or any other variation.</p>
<p>Next, we need to apply the function to several line list workbooks. For example, we do:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="cd-report.html#cb8-1" tabindex="-1"></a><span class="do">## condense and save data for analysis</span></span>
<span id="cb8-2"><a href="cd-report.html#cb8-2" tabindex="-1"></a><span class="fu">read_xlsx</span>(<span class="st">&quot;Tables/Foodborne.xlsx&quot;</span>, <span class="at">sheet =</span> <span class="st">&quot;E Coli&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="cd-report.html#cb8-3" tabindex="-1"></a>  <span class="fu">sesh_caseimport</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="cd-report.html#cb8-4" tabindex="-1"></a>  <span class="fu">saveRDS</span>(<span class="at">file =</span> <span class="st">&quot;Tables/fb_ecoli.rds&quot;</span>)</span></code></pre></div>
<p>This code:</p>
<ol style="list-style-type: decimal">
<li>Reads a specific sheet (tab) of an Excel workbook.</li>
<li>Applies <code>sesh_caseimport</code> to extract the needed data.</li>
<li>Saves the extracted data as a .rds file that can be used later.</li>
</ol>
<p>This step needs to be performed several times for each sheet from which data needs to be extracted. That can be seen in <code>import.R</code>.</p>
<p>Next, we move to the pre-analysis of demographic data.</p>
</div>
<div id="tabulating-demographic-data" class="section level2 hasAnchor" number="1.6">
<h2><span class="header-section-number">1.6</span> Tabulating demographic data<a href="cd-report.html#tabulating-demographic-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This code is in the <code>demographics.R</code> file. It performs three steps:</p>
<ol style="list-style-type: decimal">
<li>Create a list of pre-generated datasets with the needed demographic data.</li>
<li>Create three functions to classify the data, tabulate the categories, and export the new tables as .csv files.</li>
<li>Apply the functions to the list of datasets.</li>
</ol>
<p>First, we write the list:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="cd-report.html#cb9-1" tabindex="-1"></a><span class="co"># List</span></span>
<span id="cb9-2"><a href="cd-report.html#cb9-2" tabindex="-1"></a><span class="co"># This is the list of all tables to be used with the demographics script.</span></span>
<span id="cb9-3"><a href="cd-report.html#cb9-3" tabindex="-1"></a><span class="co"># This list is consistent with the tables generated by import.R.</span></span>
<span id="cb9-4"><a href="cd-report.html#cb9-4" tabindex="-1"></a>tables <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-5"><a href="cd-report.html#cb9-5" tabindex="-1"></a>  <span class="co"># Foodborne diseases</span></span>
<span id="cb9-6"><a href="cd-report.html#cb9-6" tabindex="-1"></a>  <span class="st">&quot;Tables/fb_campy.rds&quot;</span>, <span class="st">&quot;Tables/fb_ecoli.rds&quot;</span>, <span class="st">&quot;Tables/fb_hepa.rds&quot;</span>,</span>
<span id="cb9-7"><a href="cd-report.html#cb9-7" tabindex="-1"></a>    <span class="st">&quot;Tables/fb_salm.rds&quot;</span>, <span class="st">&quot;Tables/fb_shig.rds&quot;</span>,</span>
<span id="cb9-8"><a href="cd-report.html#cb9-8" tabindex="-1"></a>  <span class="co"># Vector-borne diseases</span></span>
<span id="cb9-9"><a href="cd-report.html#cb9-9" tabindex="-1"></a>  <span class="st">&quot;Tables/vb_deng.rds&quot;</span>, <span class="st">&quot;Tables/vb_ehrl.rds&quot;</span>, <span class="st">&quot;Tables/vb_ence.rds&quot;</span>,</span>
<span id="cb9-10"><a href="cd-report.html#cb9-10" tabindex="-1"></a>    <span class="st">&quot;Tables/vb_lyme.rds&quot;</span>, <span class="st">&quot;Tables/vb_mala.rds&quot;</span>, <span class="st">&quot;Tables/vb_rick.rds&quot;</span>,</span>
<span id="cb9-11"><a href="cd-report.html#cb9-11" tabindex="-1"></a>  <span class="co"># Vaccine-preventable diseases</span></span>
<span id="cb9-12"><a href="cd-report.html#cb9-12" tabindex="-1"></a>  <span class="st">&quot;Tables/vp_hepaacute.rds&quot;</span>, <span class="st">&quot;Tables/vp_hepbchron.rds&quot;</span>, <span class="st">&quot;Tables/vp_hflu.rds&quot;</span>,</span>
<span id="cb9-13"><a href="cd-report.html#cb9-13" tabindex="-1"></a>    <span class="st">&quot;Tables/vp_pert.rds&quot;</span>,</span>
<span id="cb9-14"><a href="cd-report.html#cb9-14" tabindex="-1"></a>  <span class="co"># STIs and HIV</span></span>
<span id="cb9-15"><a href="cd-report.html#cb9-15" tabindex="-1"></a>  <span class="st">&quot;Tables/st_chla.rds&quot;</span>, <span class="st">&quot;Tables/st_gono.rds&quot;</span>, <span class="st">&quot;Tables/st_hiv.rds&quot;</span>,</span>
<span id="cb9-16"><a href="cd-report.html#cb9-16" tabindex="-1"></a>  <span class="st">&quot;Tables/st_syph.rds&quot;</span></span>
<span id="cb9-17"><a href="cd-report.html#cb9-17" tabindex="-1"></a>)</span></code></pre></div>
<p>Comments are included in <code>demographics.R</code> to make the table list easier to read, but they are not required.</p>
<p>Next, we write the functions:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="cd-report.html#cb10-1" tabindex="-1"></a><span class="co"># Gender function</span></span>
<span id="cb10-2"><a href="cd-report.html#cb10-2" tabindex="-1"></a><span class="co"># Generates a set of tables for gender breakdown for each disease.</span></span>
<span id="cb10-3"><a href="cd-report.html#cb10-3" tabindex="-1"></a>sesh_gender <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb10-4"><a href="cd-report.html#cb10-4" tabindex="-1"></a>  <span class="fu">readRDS</span>(x) <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="cd-report.html#cb10-5" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">case_when</span>(gender <span class="sc">==</span> <span class="st">&quot;Male&quot;</span> <span class="sc">~</span> <span class="st">&quot;Male&quot;</span>,</span>
<span id="cb10-6"><a href="cd-report.html#cb10-6" tabindex="-1"></a>                              gender <span class="sc">==</span> <span class="st">&quot;Female&quot;</span> <span class="sc">~</span> <span class="st">&quot;Female&quot;</span>,</span>
<span id="cb10-7"><a href="cd-report.html#cb10-7" tabindex="-1"></a>                              <span class="fu">is.na</span>(gender) <span class="sc">~</span> <span class="st">&quot;Unknown&quot;</span>,</span>
<span id="cb10-8"><a href="cd-report.html#cb10-8" tabindex="-1"></a>                              <span class="at">.default =</span> <span class="st">&quot;Unknown&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="cd-report.html#cb10-9" tabindex="-1"></a>    <span class="fu">group_by</span>(gender) <span class="sc">%&gt;%</span> </span>
<span id="cb10-10"><a href="cd-report.html#cb10-10" tabindex="-1"></a>    <span class="fu">tally</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-11"><a href="cd-report.html#cb10-11" tabindex="-1"></a>    <span class="fu">spread</span>(gender, n) <span class="sc">%&gt;%</span> </span>
<span id="cb10-12"><a href="cd-report.html#cb10-12" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">total =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">everything</span>()))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-13"><a href="cd-report.html#cb10-13" tabindex="-1"></a>    <span class="fu">write_csv</span>(<span class="fu">paste0</span>(</span>
<span id="cb10-14"><a href="cd-report.html#cb10-14" tabindex="-1"></a>      <span class="st">&quot;Products/Counts/&quot;</span>,</span>
<span id="cb10-15"><a href="cd-report.html#cb10-15" tabindex="-1"></a>      <span class="fu">str_remove</span>(x, <span class="st">&quot;Tables/&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-16"><a href="cd-report.html#cb10-16" tabindex="-1"></a>        <span class="fu">str_remove</span>(<span class="st">&quot;.rds&quot;</span>),</span>
<span id="cb10-17"><a href="cd-report.html#cb10-17" tabindex="-1"></a>      <span class="st">&quot;-gender.csv&quot;</span></span>
<span id="cb10-18"><a href="cd-report.html#cb10-18" tabindex="-1"></a>    ))</span>
<span id="cb10-19"><a href="cd-report.html#cb10-19" tabindex="-1"></a>}</span>
<span id="cb10-20"><a href="cd-report.html#cb10-20" tabindex="-1"></a></span>
<span id="cb10-21"><a href="cd-report.html#cb10-21" tabindex="-1"></a></span>
<span id="cb10-22"><a href="cd-report.html#cb10-22" tabindex="-1"></a><span class="co"># Age function</span></span>
<span id="cb10-23"><a href="cd-report.html#cb10-23" tabindex="-1"></a><span class="co"># Creates age categories, then generates tables for age breakdowns by disease.</span></span>
<span id="cb10-24"><a href="cd-report.html#cb10-24" tabindex="-1"></a>sesh_age <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb10-25"><a href="cd-report.html#cb10-25" tabindex="-1"></a>  <span class="fu">readRDS</span>(x) <span class="sc">%&gt;%</span> </span>
<span id="cb10-26"><a href="cd-report.html#cb10-26" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age_g =</span> <span class="fu">case_when</span>(age <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">&quot;0-4&quot;</span>,</span>
<span id="cb10-27"><a href="cd-report.html#cb10-27" tabindex="-1"></a>                             age <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">17</span> <span class="sc">~</span> <span class="st">&quot;5-17&quot;</span>,</span>
<span id="cb10-28"><a href="cd-report.html#cb10-28" tabindex="-1"></a>                             age <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">24</span> <span class="sc">~</span> <span class="st">&quot;18-24&quot;</span>,</span>
<span id="cb10-29"><a href="cd-report.html#cb10-29" tabindex="-1"></a>                             age <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">49</span> <span class="sc">~</span> <span class="st">&quot;25-49&quot;</span>,</span>
<span id="cb10-30"><a href="cd-report.html#cb10-30" tabindex="-1"></a>                             age <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">64</span> <span class="sc">~</span> <span class="st">&quot;50-64&quot;</span>,</span>
<span id="cb10-31"><a href="cd-report.html#cb10-31" tabindex="-1"></a>                             age <span class="sc">&gt;=</span> <span class="dv">65</span> <span class="sc">~</span> <span class="st">&quot;65+&quot;</span>,</span>
<span id="cb10-32"><a href="cd-report.html#cb10-32" tabindex="-1"></a>                             <span class="at">.default =</span> <span class="st">&quot;Unknown&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-33"><a href="cd-report.html#cb10-33" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age_g =</span> <span class="fu">factor</span>(age_g, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;0-4&quot;</span>, <span class="st">&quot;5-17&quot;</span>,</span>
<span id="cb10-34"><a href="cd-report.html#cb10-34" tabindex="-1"></a>                                            <span class="st">&quot;18-24&quot;</span>, <span class="st">&quot;25-49&quot;</span>,</span>
<span id="cb10-35"><a href="cd-report.html#cb10-35" tabindex="-1"></a>                                            <span class="st">&quot;50-64&quot;</span>, <span class="st">&quot;65+&quot;</span>,</span>
<span id="cb10-36"><a href="cd-report.html#cb10-36" tabindex="-1"></a>                                            <span class="st">&quot;Unknown&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-37"><a href="cd-report.html#cb10-37" tabindex="-1"></a>    <span class="fu">group_by</span>(age_g) <span class="sc">%&gt;%</span> </span>
<span id="cb10-38"><a href="cd-report.html#cb10-38" tabindex="-1"></a>    <span class="fu">tally</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-39"><a href="cd-report.html#cb10-39" tabindex="-1"></a>    <span class="fu">spread</span>(age_g, n) <span class="sc">%&gt;%</span> </span>
<span id="cb10-40"><a href="cd-report.html#cb10-40" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">total =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">everything</span>()))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-41"><a href="cd-report.html#cb10-41" tabindex="-1"></a>    <span class="fu">write_csv</span>(<span class="fu">paste0</span>(</span>
<span id="cb10-42"><a href="cd-report.html#cb10-42" tabindex="-1"></a>      <span class="st">&quot;Products/Counts/&quot;</span>,</span>
<span id="cb10-43"><a href="cd-report.html#cb10-43" tabindex="-1"></a>      <span class="fu">str_remove</span>(x, <span class="st">&quot;Tables/&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-44"><a href="cd-report.html#cb10-44" tabindex="-1"></a>        <span class="fu">str_remove</span>(<span class="st">&quot;.rds&quot;</span>),</span>
<span id="cb10-45"><a href="cd-report.html#cb10-45" tabindex="-1"></a>      <span class="st">&quot;-age.csv&quot;</span></span>
<span id="cb10-46"><a href="cd-report.html#cb10-46" tabindex="-1"></a>    ))</span>
<span id="cb10-47"><a href="cd-report.html#cb10-47" tabindex="-1"></a>}</span>
<span id="cb10-48"><a href="cd-report.html#cb10-48" tabindex="-1"></a></span>
<span id="cb10-49"><a href="cd-report.html#cb10-49" tabindex="-1"></a></span>
<span id="cb10-50"><a href="cd-report.html#cb10-50" tabindex="-1"></a><span class="co"># Race/ethnicity function</span></span>
<span id="cb10-51"><a href="cd-report.html#cb10-51" tabindex="-1"></a><span class="co"># Creates race/ethnicity categories, then generates tables for race breakdowns.</span></span>
<span id="cb10-52"><a href="cd-report.html#cb10-52" tabindex="-1"></a>sesh_raceth <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb10-53"><a href="cd-report.html#cb10-53" tabindex="-1"></a>  <span class="fu">readRDS</span>(x) <span class="sc">%&gt;%</span> </span>
<span id="cb10-54"><a href="cd-report.html#cb10-54" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">raceth =</span> <span class="fu">case_when</span>(race <span class="sc">==</span> <span class="st">&quot;White&quot;</span> <span class="sc">~</span> race,</span>
<span id="cb10-55"><a href="cd-report.html#cb10-55" tabindex="-1"></a>                              race <span class="sc">==</span> <span class="st">&quot;Black or African American&quot;</span> <span class="sc">~</span> race,</span>
<span id="cb10-56"><a href="cd-report.html#cb10-56" tabindex="-1"></a>                              race <span class="sc">==</span> <span class="st">&quot;Asian&quot;</span> <span class="sc">~</span> race,</span>
<span id="cb10-57"><a href="cd-report.html#cb10-57" tabindex="-1"></a>                              race <span class="sc">==</span> <span class="st">&quot;Other&quot;</span> <span class="sc">~</span> race,</span>
<span id="cb10-58"><a href="cd-report.html#cb10-58" tabindex="-1"></a>                              race <span class="sc">==</span> <span class="st">&quot;American Indian Alaskan Native&quot;</span> <span class="sc">~</span> <span class="st">&quot;Other&quot;</span>,</span>
<span id="cb10-59"><a href="cd-report.html#cb10-59" tabindex="-1"></a>                              race <span class="sc">==</span> <span class="st">&quot;Native Hawaiian or Pacific Islander&quot;</span> <span class="sc">~</span> <span class="st">&quot;Other&quot;</span>,</span>
<span id="cb10-60"><a href="cd-report.html#cb10-60" tabindex="-1"></a>                              <span class="fu">str_detect</span>(race, <span class="st">&quot;,&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Two or more races&quot;</span>,</span>
<span id="cb10-61"><a href="cd-report.html#cb10-61" tabindex="-1"></a>                              <span class="at">.default =</span> <span class="st">&quot;Unknown&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-62"><a href="cd-report.html#cb10-62" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">raceth =</span> <span class="fu">factor</span>(raceth, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Asian&quot;</span>, <span class="st">&quot;Black or African American&quot;</span>,</span>
<span id="cb10-63"><a href="cd-report.html#cb10-63" tabindex="-1"></a>                                              <span class="st">&quot;White&quot;</span>, <span class="st">&quot;Other&quot;</span>, <span class="st">&quot;Two or more races&quot;</span>,</span>
<span id="cb10-64"><a href="cd-report.html#cb10-64" tabindex="-1"></a>                                              <span class="st">&quot;Unknown&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-65"><a href="cd-report.html#cb10-65" tabindex="-1"></a>    <span class="fu">group_by</span>(raceth) <span class="sc">%&gt;%</span> </span>
<span id="cb10-66"><a href="cd-report.html#cb10-66" tabindex="-1"></a>    <span class="fu">tally</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-67"><a href="cd-report.html#cb10-67" tabindex="-1"></a>    <span class="fu">spread</span>(raceth, n) <span class="sc">%&gt;%</span> </span>
<span id="cb10-68"><a href="cd-report.html#cb10-68" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">total =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">everything</span>()))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-69"><a href="cd-report.html#cb10-69" tabindex="-1"></a>    <span class="fu">write_csv</span>(<span class="fu">paste0</span>(</span>
<span id="cb10-70"><a href="cd-report.html#cb10-70" tabindex="-1"></a>      <span class="st">&quot;Products/Counts/&quot;</span>,</span>
<span id="cb10-71"><a href="cd-report.html#cb10-71" tabindex="-1"></a>      <span class="fu">str_remove</span>(x, <span class="st">&quot;Tables/&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-72"><a href="cd-report.html#cb10-72" tabindex="-1"></a>        <span class="fu">str_remove</span>(<span class="st">&quot;.rds&quot;</span>),</span>
<span id="cb10-73"><a href="cd-report.html#cb10-73" tabindex="-1"></a>      <span class="st">&quot;-raceth.csv&quot;</span></span>
<span id="cb10-74"><a href="cd-report.html#cb10-74" tabindex="-1"></a>    ))</span>
<span id="cb10-75"><a href="cd-report.html#cb10-75" tabindex="-1"></a>}</span></code></pre></div>
<p>These three functions:</p>
<ol style="list-style-type: decimal">
<li>Read the specified datasets.</li>
<li><em>Mutate</em> (create) the <code>gender</code>, <code>age_g</code>, and <code>raceth</code> columns with standardized categories. This uses the <code>case_when()</code> function, which is essentially a cleaner way of writing a series of <code>if</code> and <code>else</code> expressions. For example, <code>race == "White" ~ race</code> says “if race is equal to ‘White’, use the value from race for raceth”, and <code>race == "American Indian Alaskan Native" ~ "Other"</code> says “if race is equal to AIAN, use ‘Other’ as the value for raceth”.</li>
<li><em>Mutate</em> the <code>age_g</code> and <code>raceth</code> columns to be factors instead of character variables. This orders the data, which will make the exported tables more logical.</li>
<li>Group the data using <code>group_by()</code>.</li>
<li><em>Tally</em> the data according to the groups (<code>gender</code>, <code>age_g</code>, or <code>raceth</code>).</li>
<li><em>Spread</em> the data so that the columns become the counts by group.</li>
<li><em>Mutate</em> (create) a total column.</li>
<li>Save the data as a .csv file. This function appears complicated, but it simply removes “Tables/” and “.rds” from the listing in the original table and adds the appropriate file path and file extension.</li>
</ol>
<p>Finally, we apply these three functions to all of the listed tables:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="cd-report.html#cb11-1" tabindex="-1"></a><span class="co"># Table generation</span></span>
<span id="cb11-2"><a href="cd-report.html#cb11-2" tabindex="-1"></a><span class="co"># Apply above functions to list of tables</span></span>
<span id="cb11-3"><a href="cd-report.html#cb11-3" tabindex="-1"></a><span class="fu">lapply</span>(tables, sesh_gender)</span>
<span id="cb11-4"><a href="cd-report.html#cb11-4" tabindex="-1"></a><span class="fu">lapply</span>(tables, sesh_age)</span>
<span id="cb11-5"><a href="cd-report.html#cb11-5" tabindex="-1"></a><span class="fu">lapply</span>(tables, sesh_raceth)</span></code></pre></div>
<p>Each of these functions just say “apply the <code>sesh_...</code> function to each item in the list <code>tables</code>”. This is a much faster and cleaner way of performing these three repetitive tasks than the alternative, which would be to write each of the three functions 19 times, changing the file names each time. It also allows for much more flexibility if diseases need to be added or removed from analysis.</p>
<p>When the functions are applied, 57 tables are generated in <code>Products/Counts/</code>. They only contain a row of headers, which are the specified groups, and a row of counts.</p>
</div>
<div id="calculating-incidence-by-zip-code" class="section level2 hasAnchor" number="1.7">
<h2><span class="header-section-number">1.7</span> Calculating incidence by ZIP code<a href="cd-report.html#calculating-incidence-by-zip-code" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Last, in the <code>ratesbyzip.R</code> script, we calculate the incidence of specified diseases in each Wake County ZIP code. First, we read in exported population data from the American Community Survey:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="cd-report.html#cb12-1" tabindex="-1"></a><span class="co"># 2022 ACS Demographic Estimates for Wake County</span></span>
<span id="cb12-2"><a href="cd-report.html#cb12-2" tabindex="-1"></a><span class="do">## Import sheet, remove extraneous data, and clean up</span></span>
<span id="cb12-3"><a href="cd-report.html#cb12-3" tabindex="-1"></a>acs <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;Tables/ACS demographic estimates 2022 by zip code.xlsx&quot;</span>,</span>
<span id="cb12-4"><a href="cd-report.html#cb12-4" tabindex="-1"></a>                 <span class="at">sheet =</span> <span class="st">&quot;Data&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="cd-report.html#cb12-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&#39;ZCTA5 Age&#39;</span> <span class="ot">=</span> <span class="st">`</span><span class="at">...1</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-6"><a href="cd-report.html#cb12-6" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="st">`</span><span class="at">ZCTA5 Age</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-7"><a href="cd-report.html#cb12-7" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;ZCTA5&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-8"><a href="cd-report.html#cb12-8" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">str_remove</span>(., <span class="st">&quot;ZCTA5 &quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-9"><a href="cd-report.html#cb12-9" tabindex="-1"></a>  <span class="fu">filter</span>(Age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;10 to 14 years&quot;</span>, <span class="st">&quot;15 to 19 years&quot;</span>, <span class="st">&quot;20 to 24 years&quot;</span>,</span>
<span id="cb12-10"><a href="cd-report.html#cb12-10" tabindex="-1"></a>                    <span class="st">&quot;25 to 34 years&quot;</span>, <span class="st">&quot;35 to 44 years&quot;</span>, <span class="st">&quot;45 to 54 years&quot;</span>,</span>
<span id="cb12-11"><a href="cd-report.html#cb12-11" tabindex="-1"></a>                    <span class="st">&quot;55 to 59 years&quot;</span>, <span class="st">&quot;60 to 64 years&quot;</span>, <span class="st">&quot;65 to 74 years&quot;</span>,</span>
<span id="cb12-12"><a href="cd-report.html#cb12-12" tabindex="-1"></a>                    <span class="st">&quot;75 to 84 years&quot;</span>, <span class="st">&quot;85 years and over&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-13"><a href="cd-report.html#cb12-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">!</span>Age, <span class="sc">~</span><span class="fu">str_remove</span>(., <span class="st">&quot;,&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb12-14"><a href="cd-report.html#cb12-14" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">!</span>Age, as.numeric))</span></code></pre></div>
<p>This code imports the spreadsheet, performs some tricks (<code>mutate</code>, <code>relocate</code>, <code>select</code>, and <code>rename_with</code>) to select just the necessary columns, <em>filters</em> to select just the rows with populations vulnerable to STIs, and <em>mutates</em> the columns with population values to become numeric (without the included comma separators).</p>
<p>Next, we total the populations across selected age groups and pivot the data so that each row is a ZIP code and a total vulnerable population:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="cd-report.html#cb13-1" tabindex="-1"></a><span class="do">## Total age groups &gt;= 10 and pivot</span></span>
<span id="cb13-2"><a href="cd-report.html#cb13-2" tabindex="-1"></a>popbyzip <span class="ot">&lt;-</span> acs <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="cd-report.html#cb13-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">sum</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="cd-report.html#cb13-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;ZIP&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Population&quot;</span>)</span></code></pre></div>
<p>Then, we list the tables of real data we want to work with, similar to <code>demographics.R</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="cd-report.html#cb14-1" tabindex="-1"></a><span class="co"># List</span></span>
<span id="cb14-2"><a href="cd-report.html#cb14-2" tabindex="-1"></a><span class="do">## List line list tables for mapping</span></span>
<span id="cb14-3"><a href="cd-report.html#cb14-3" tabindex="-1"></a>tables <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb14-4"><a href="cd-report.html#cb14-4" tabindex="-1"></a>  <span class="co"># STDs and HIV</span></span>
<span id="cb14-5"><a href="cd-report.html#cb14-5" tabindex="-1"></a>  <span class="st">&quot;Tables/st_chla.rds&quot;</span>, <span class="st">&quot;Tables/st_gono.rds&quot;</span>, <span class="st">&quot;Tables/st_hiv.rds&quot;</span>,</span>
<span id="cb14-6"><a href="cd-report.html#cb14-6" tabindex="-1"></a>  <span class="st">&quot;Tables/st_syph.rds&quot;</span></span>
<span id="cb14-7"><a href="cd-report.html#cb14-7" tabindex="-1"></a>)</span></code></pre></div>
<p>Then, we create a function that calculates the incidence in each ZIP code:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="cd-report.html#cb15-1" tabindex="-1"></a><span class="co"># Rate by ZIP function</span></span>
<span id="cb15-2"><a href="cd-report.html#cb15-2" tabindex="-1"></a><span class="do">## Creates tables to calculate rates from counts and populations</span></span>
<span id="cb15-3"><a href="cd-report.html#cb15-3" tabindex="-1"></a>sesh_ratebyzip <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb15-4"><a href="cd-report.html#cb15-4" tabindex="-1"></a>  <span class="fu">readRDS</span>(x) <span class="sc">%&gt;%</span> </span>
<span id="cb15-5"><a href="cd-report.html#cb15-5" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">allZIP =</span> <span class="fu">as.numeric</span>(</span>
<span id="cb15-6"><a href="cd-report.html#cb15-6" tabindex="-1"></a>      <span class="fu">substr</span>(<span class="fu">as.character</span>(zip), <span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb15-7"><a href="cd-report.html#cb15-7" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span> </span>
<span id="cb15-8"><a href="cd-report.html#cb15-8" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ZIP =</span> <span class="fu">case_when</span>(allZIP <span class="sc">%in%</span> popbyzip<span class="sc">$</span>ZIP <span class="sc">~</span> allZIP,</span>
<span id="cb15-9"><a href="cd-report.html#cb15-9" tabindex="-1"></a>                           <span class="at">.default =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-10"><a href="cd-report.html#cb15-10" tabindex="-1"></a>    <span class="fu">group_by</span>(ZIP) <span class="sc">%&gt;%</span> </span>
<span id="cb15-11"><a href="cd-report.html#cb15-11" tabindex="-1"></a>    <span class="fu">tally</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-12"><a href="cd-report.html#cb15-12" tabindex="-1"></a>    <span class="fu">spread</span>(ZIP, n) <span class="sc">%&gt;%</span> </span>
<span id="cb15-13"><a href="cd-report.html#cb15-13" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;ZIP&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Cases&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-14"><a href="cd-report.html#cb15-14" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ZIP =</span> <span class="fu">as.numeric</span>(ZIP)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-15"><a href="cd-report.html#cb15-15" tabindex="-1"></a>    <span class="fu">right_join</span>(popbyzip <span class="sc">%&gt;%</span> </span>
<span id="cb15-16"><a href="cd-report.html#cb15-16" tabindex="-1"></a>                 <span class="fu">mutate</span>(<span class="at">ZIP =</span> <span class="fu">as.numeric</span>(ZIP)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-17"><a href="cd-report.html#cb15-17" tabindex="-1"></a>                 <span class="fu">add_row</span>(<span class="at">ZIP =</span> <span class="dv">0</span>,</span>
<span id="cb15-18"><a href="cd-report.html#cb15-18" tabindex="-1"></a>                         <span class="at">Population =</span> <span class="cn">NA</span>),</span>
<span id="cb15-19"><a href="cd-report.html#cb15-19" tabindex="-1"></a>               <span class="at">by =</span> <span class="fu">join_by</span>(ZIP)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-20"><a href="cd-report.html#cb15-20" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">&#39;Rate per 1000&#39;</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb15-21"><a href="cd-report.html#cb15-21" tabindex="-1"></a>      ZIP <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> Cases,</span>
<span id="cb15-22"><a href="cd-report.html#cb15-22" tabindex="-1"></a>      <span class="at">.default =</span> Cases <span class="sc">/</span> Population <span class="sc">*</span> <span class="dv">1000</span></span>
<span id="cb15-23"><a href="cd-report.html#cb15-23" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span> </span>
<span id="cb15-24"><a href="cd-report.html#cb15-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ZIP =</span> <span class="fu">case_when</span>(ZIP <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb15-25"><a href="cd-report.html#cb15-25" tabindex="-1"></a>                           <span class="at">.default =</span> ZIP),</span>
<span id="cb15-26"><a href="cd-report.html#cb15-26" tabindex="-1"></a>           <span class="st">`</span><span class="at">Rate per 1000</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(<span class="st">`</span><span class="at">Rate per 1000</span><span class="st">`</span>) <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb15-27"><a href="cd-report.html#cb15-27" tabindex="-1"></a>                                       <span class="at">.default =</span> <span class="st">`</span><span class="at">Rate per 1000</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-28"><a href="cd-report.html#cb15-28" tabindex="-1"></a>    <span class="fu">arrange</span>(ZIP) <span class="sc">%&gt;%</span> </span>
<span id="cb15-29"><a href="cd-report.html#cb15-29" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">c</span>(ZIP, <span class="st">`</span><span class="at">Rate per 1000</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-30"><a href="cd-report.html#cb15-30" tabindex="-1"></a>    <span class="fu">write_csv</span>(<span class="fu">paste0</span>(</span>
<span id="cb15-31"><a href="cd-report.html#cb15-31" tabindex="-1"></a>      <span class="st">&quot;Products/Rates/&quot;</span>,</span>
<span id="cb15-32"><a href="cd-report.html#cb15-32" tabindex="-1"></a>      <span class="fu">str_remove</span>(x, <span class="st">&quot;Tables/&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-33"><a href="cd-report.html#cb15-33" tabindex="-1"></a>        <span class="fu">str_remove</span>(<span class="st">&quot;.rds&quot;</span>),</span>
<span id="cb15-34"><a href="cd-report.html#cb15-34" tabindex="-1"></a>      <span class="st">&quot;-ratebyzip.csv&quot;</span></span>
<span id="cb15-35"><a href="cd-report.html#cb15-35" tabindex="-1"></a>    ))</span>
<span id="cb15-36"><a href="cd-report.html#cb15-36" tabindex="-1"></a>}</span></code></pre></div>
<p>This function performs the following steps:</p>
<ol style="list-style-type: decimal">
<li>Read the specified disease’s dataset.</li>
<li><em>Mutate</em> <code>allZIP</code> from the <code>zip</code> column, removing any extra digits from the postal code (for instance, <code>27610-1808</code> becomes <code>27610</code>).</li>
<li><em>Mutate</em> <code>ZIP</code> from <code>allZIP</code>, keeping the values of any ZIP code in Wake County (<code>allZIP %in% popbyzip$ZIP</code>) and setting any others to 0.</li>
<li><em>Group</em>, <em>tally</em>, and <em>spread</em> counts across ZIP code columns.</li>
<li><em>Pivot</em> the data so that each row is a ZIP code and a count.</li>
<li><em>Mutate</em> ZIP to be numeric for ordering purposes.</li>
<li><em>Join</em>, or merge, the population data with the case data.</li>
<li><em>Mutate</em> a new “Rate per 1000” column that calculates the incidence from cases and populations, but setting the value for “Rate per 1000” where there is no ZIP code to be the number of cases not in a Wake County ZIP.</li>
<li>Edit the non-Wake ZIP row to have NA in the ZIP field, and edit any rows for ZIP codes with no cases to have a rate of 0.</li>
<li><em>Arrange</em> (order) the entries by ZIP code, then select just the two needed columns.</li>
<li>Save the table in the appropriate folder.</li>
</ol>
<p>Finally, we need to apply this function to the list of tables we specified earlier, similarly to <code>demographics.R</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="cd-report.html#cb16-1" tabindex="-1"></a><span class="co"># Table generation</span></span>
<span id="cb16-2"><a href="cd-report.html#cb16-2" tabindex="-1"></a><span class="do">## Apply above function to list of tables</span></span>
<span id="cb16-3"><a href="cd-report.html#cb16-3" tabindex="-1"></a><span class="fu">lapply</span>(tables, sesh_ratebyzip)</span></code></pre></div>
<p>Once this script is run, there are four exported .csv files with rates for each ZIP code and a row specifying the number of Wake cases that were not matched to a Wake ZIP code.</p>
</div>
<div id="generating-counts-and-rates-tables" class="section level2 hasAnchor" number="1.8">
<h2><span class="header-section-number">1.8</span> Generating counts and rates tables<a href="cd-report.html#generating-counts-and-rates-tables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The notifiables data processed earlier is used to generate tables of counts and rates of communicable diseases for each of the last five years. To do this, R Markdown is used to create an HTML file (webpage) with each table. For the purposes of this report, those tables were exported to Microsoft Word and formatted there.</p>
<p>To generate the counts and rates table, we need to load two libraries: <code>tidyverse</code>, as used before, and <code>kableExtra</code>, which provides some useful table formatting options. We also need to load the necessary data and make one small change: removing the “dz-” abbreviation from some disease names.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="cd-report.html#cb17-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb17-2"><a href="cd-report.html#cb17-2" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb17-3"><a href="cd-report.html#cb17-3" tabindex="-1"></a>notif <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../Tables/notifiables.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="cd-report.html#cb17-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(disease, c2019, r2019, c2020, r2020, c2021, r2021, c2022, r2022, c2023, r2023)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href="cd-report.html#cb17-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">disease =</span> <span class="fu">str_remove</span>(disease, <span class="st">&quot;dz- &quot;</span>))</span></code></pre></div>
<p>Then, we do a few setup tasks: changing an option so that any NA values will appear as two asterisks, creating a list of column headers (the final table will have a few header rows), and writing a function to generate the tables.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="cd-report.html#cb18-1" tabindex="-1"></a><span class="co"># Change NA fill value</span></span>
<span id="cb18-2"><a href="cd-report.html#cb18-2" tabindex="-1"></a>opts <span class="ot">&lt;-</span> <span class="fu">options</span>(<span class="at">knitr.kable.NA =</span> <span class="st">&quot;**&quot;</span>)</span>
<span id="cb18-3"><a href="cd-report.html#cb18-3" tabindex="-1"></a></span>
<span id="cb18-4"><a href="cd-report.html#cb18-4" tabindex="-1"></a><span class="co"># Set table column names</span></span>
<span id="cb18-5"><a href="cd-report.html#cb18-5" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb18-6"><a href="cd-report.html#cb18-6" tabindex="-1"></a>  <span class="st">&quot;Disease/Condition&quot;</span>,</span>
<span id="cb18-7"><a href="cd-report.html#cb18-7" tabindex="-1"></a>  <span class="st">&quot;No. of Cases&quot;</span>, <span class="st">&quot;Case Rate (+)&quot;</span>,</span>
<span id="cb18-8"><a href="cd-report.html#cb18-8" tabindex="-1"></a>  <span class="st">&quot;No. of Cases&quot;</span>, <span class="st">&quot;Case Rate (+)&quot;</span>,</span>
<span id="cb18-9"><a href="cd-report.html#cb18-9" tabindex="-1"></a>  <span class="st">&quot;No. of Cases&quot;</span>, <span class="st">&quot;Case Rate (+)&quot;</span>,</span>
<span id="cb18-10"><a href="cd-report.html#cb18-10" tabindex="-1"></a>  <span class="st">&quot;No. of Cases&quot;</span>, <span class="st">&quot;Case Rate (+)&quot;</span>,</span>
<span id="cb18-11"><a href="cd-report.html#cb18-11" tabindex="-1"></a>  <span class="st">&quot;No. of Cases&quot;</span>, <span class="st">&quot;Case Rate (+)&quot;</span></span>
<span id="cb18-12"><a href="cd-report.html#cb18-12" tabindex="-1"></a>)</span>
<span id="cb18-13"><a href="cd-report.html#cb18-13" tabindex="-1"></a></span>
<span id="cb18-14"><a href="cd-report.html#cb18-14" tabindex="-1"></a><span class="co"># Create function to generate table</span></span>
<span id="cb18-15"><a href="cd-report.html#cb18-15" tabindex="-1"></a>sesh_kable <span class="ot">&lt;-</span> <span class="cf">function</span>(x, dc){</span>
<span id="cb18-16"><a href="cd-report.html#cb18-16" tabindex="-1"></a>  x <span class="sc">%&gt;%</span></span>
<span id="cb18-17"><a href="cd-report.html#cb18-17" tabindex="-1"></a>    <span class="fu">full_join</span>(</span>
<span id="cb18-18"><a href="cd-report.html#cb18-18" tabindex="-1"></a>      <span class="fu">read_csv</span>(<span class="st">&quot;../Tables/categories.csv&quot;</span>),</span>
<span id="cb18-19"><a href="cd-report.html#cb18-19" tabindex="-1"></a>      <span class="at">by =</span> <span class="fu">join_by</span>(disease)</span>
<span id="cb18-20"><a href="cd-report.html#cb18-20" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-21"><a href="cd-report.html#cb18-21" tabindex="-1"></a>    <span class="fu">filter</span>(category <span class="sc">==</span> dc) <span class="sc">%&gt;%</span> </span>
<span id="cb18-22"><a href="cd-report.html#cb18-22" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">!</span>category) <span class="sc">%&gt;%</span> </span>
<span id="cb18-23"><a href="cd-report.html#cb18-23" tabindex="-1"></a>    <span class="fu">kable</span>(</span>
<span id="cb18-24"><a href="cd-report.html#cb18-24" tabindex="-1"></a>      <span class="at">format =</span> <span class="st">&quot;html&quot;</span>,</span>
<span id="cb18-25"><a href="cd-report.html#cb18-25" tabindex="-1"></a>      <span class="at">align =</span> <span class="st">&quot;lcccccccccc&quot;</span>,</span>
<span id="cb18-26"><a href="cd-report.html#cb18-26" tabindex="-1"></a>      <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>),</span>
<span id="cb18-27"><a href="cd-report.html#cb18-27" tabindex="-1"></a>      <span class="at">col.names =</span> cols</span>
<span id="cb18-28"><a href="cd-report.html#cb18-28" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-29"><a href="cd-report.html#cb18-29" tabindex="-1"></a>    <span class="fu">add_header_above</span>(</span>
<span id="cb18-30"><a href="cd-report.html#cb18-30" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">&quot; &quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;All Statuses (Confirmed, Probable, and Suspect)&quot;</span> <span class="ot">=</span> <span class="dv">10</span>)</span>
<span id="cb18-31"><a href="cd-report.html#cb18-31" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-32"><a href="cd-report.html#cb18-32" tabindex="-1"></a>    <span class="fu">add_header_above</span>(</span>
<span id="cb18-33"><a href="cd-report.html#cb18-33" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">&quot;Population:&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;1,112,795&quot;</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot;1,129,393&quot;</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot;1,152,357&quot;</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb18-34"><a href="cd-report.html#cb18-34" tabindex="-1"></a>        <span class="st">&quot;1,175,021&quot;</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot;data N/A&quot;</span> <span class="ot">=</span> <span class="dv">2</span> )</span>
<span id="cb18-35"><a href="cd-report.html#cb18-35" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-36"><a href="cd-report.html#cb18-36" tabindex="-1"></a>    <span class="fu">add_header_above</span>(</span>
<span id="cb18-37"><a href="cd-report.html#cb18-37" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">&quot; &quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;2019&quot;</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot;2020&quot;</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot;2021&quot;</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot;2022&quot;</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot;2023&quot;</span> <span class="ot">=</span> <span class="dv">2</span>)</span>
<span id="cb18-38"><a href="cd-report.html#cb18-38" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-39"><a href="cd-report.html#cb18-39" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">html_font =</span> <span class="st">&quot;arial&quot;</span>, <span class="at">bootstrap_options =</span> <span class="st">&quot;striped&quot;</span>)</span>
<span id="cb18-40"><a href="cd-report.html#cb18-40" tabindex="-1"></a>}</span></code></pre></div>
<p>The function performs the following steps:</p>
<ol style="list-style-type: decimal">
<li><em>Join</em> (match) the notifiables data to a list of disease categories so that each category can have its own table.</li>
<li><em>Filter</em> the merged data to keep only the current category of interest (specified with the <code>dc</code> function argument).</li>
<li><em>Select</em> to remove the disease category column from the data.</li>
<li>Create a table (using <code>kable()</code>) in HTML format. The <code>align</code> option sets the alignment of the data within the columns (here, the first column is left-justified and the rest are centered). The <code>format.args</code> option here inserts comma separators and ensures no data is in scientific notation. The <code>col.names</code> argument uses the <code>cols</code> list we specified above to set the bottom row of column headers.</li>
<li>Add three header rows, from bottom to top. First, we add a row that clarifies what case statuses are included in the table, which is centered over the 10 rows of numbers (<code>"All Statuses (Confirmed, Probable, and Suspect)" = 10</code>). Next, we add a row that centers the annual population over each case/rate pair of columns. Then, we add the top header, which specifies the year of each pair.</li>
<li>Last, we specify some style choices: Arial font and striped rows.</li>
</ol>
<p>We then apply these functions within an R code chunk.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="cd-report.html#cb19-1" tabindex="-1"></a><span class="fu">sesh_kable</span>(notif, <span class="st">&quot;vp&quot;</span>)</span></code></pre></div>
<p>For this function call, we specify the dataset we want to use (<code>notif</code>, loaded earlier) and the disease category we’re interested in (in this case, vaccine-preventable diseases, abbreviated <code>"vp"</code>).</p>
<p>Because we’re working in R Markdown (and not just an R script), we are able to format a header and footnote around the table. We do that like so:</p>
<pre><code>### Table 1: Vaccine-Preventable Diseases among Wake County Residents, 2019-2023

{r code chunk here}

(+)Rate per 100,000 population.

**Case and rate data may not be available for all diseases in preliminary reporting.

-Case Rate is not calculated when counts are too low.

All statuses (confirmed, probable, and suspect cases) are reported in this section.</code></pre>
<p>When we do this for each of the seven tables, we generate a nice-looking table in HTML that can be copied to Microsoft Word or used as-is. As an example, see the <a href="./Notifiables-Table.html">output for the 2024 Communicable Disease Report</a>.</p>
</div>
<div id="final-notes" class="section level2 hasAnchor" number="1.9">
<h2><span class="header-section-number">1.9</span> Final notes<a href="cd-report.html#final-notes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This wraps up the R code contributed to the 2024 Communicable Disease Report. This code is also reusable with minor edits and can be applied to future reporting cycles. See the HOW-TO.docx document in the SharePoint for more information.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mch-report.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 3 STIs | In-Service Presentation, August 2024</title>
  <meta name="description" content="Section 3 STIs | In-Service Presentation, August 2024" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 3 STIs | In-Service Presentation, August 2024" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 3 STIs | In-Service Presentation, August 2024" />
  
  
  

<meta name="author" content="Alec Higgins" />


<meta name="date" content="2024-08-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="mch-report.html"/>
<link rel="next" href="respiratory-viruses.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Alec Higgins In-Service Presentation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sections"><i class="fa fa-check"></i>Sections</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="cd-report.html"><a href="cd-report.html"><i class="fa fa-check"></i><b>1</b> 2024 CD Report</a>
<ul>
<li class="chapter" data-level="1.1" data-path="cd-report.html"><a href="cd-report.html#libraries"><i class="fa fa-check"></i><b>1.1</b> Libraries</a></li>
<li class="chapter" data-level="1.2" data-path="cd-report.html"><a href="cd-report.html#settings"><i class="fa fa-check"></i><b>1.2</b> Settings</a></li>
<li class="chapter" data-level="1.3" data-path="cd-report.html"><a href="cd-report.html#reading-data-then-saving"><i class="fa fa-check"></i><b>1.3</b> Reading data, then saving</a></li>
<li class="chapter" data-level="1.4" data-path="cd-report.html"><a href="cd-report.html#combining-and-saving-data"><i class="fa fa-check"></i><b>1.4</b> Combining and saving data</a></li>
<li class="chapter" data-level="1.5" data-path="cd-report.html"><a href="cd-report.html#extracting-and-exporting-demographic-data-from-a-line-list"><i class="fa fa-check"></i><b>1.5</b> Extracting and exporting demographic data from a line list</a></li>
<li class="chapter" data-level="1.6" data-path="cd-report.html"><a href="cd-report.html#tabulating-demographic-data"><i class="fa fa-check"></i><b>1.6</b> Tabulating demographic data</a></li>
<li class="chapter" data-level="1.7" data-path="cd-report.html"><a href="cd-report.html#calculating-incidence-by-zip-code"><i class="fa fa-check"></i><b>1.7</b> Calculating incidence by ZIP code</a></li>
<li class="chapter" data-level="1.8" data-path="cd-report.html"><a href="cd-report.html#generating-counts-and-rates-tables"><i class="fa fa-check"></i><b>1.8</b> Generating counts and rates tables</a></li>
<li class="chapter" data-level="1.9" data-path="cd-report.html"><a href="cd-report.html#final-notes"><i class="fa fa-check"></i><b>1.9</b> Final notes</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="mch-report.html"><a href="mch-report.html"><i class="fa fa-check"></i><b>2</b> 2024 MCH Report</a>
<ul>
<li class="chapter" data-level="2.1" data-path="mch-report.html"><a href="mch-report.html#libraries-1"><i class="fa fa-check"></i><b>2.1</b> Libraries</a></li>
<li class="chapter" data-level="2.2" data-path="mch-report.html"><a href="mch-report.html#transposing-data"><i class="fa fa-check"></i><b>2.2</b> Transposing data</a></li>
<li class="chapter" data-level="2.3" data-path="mch-report.html"><a href="mch-report.html#importing-data"><i class="fa fa-check"></i><b>2.3</b> Importing data</a></li>
<li class="chapter" data-level="2.4" data-path="mch-report.html"><a href="mch-report.html#cleaning-and-combining-data"><i class="fa fa-check"></i><b>2.4</b> Cleaning and combining data</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="mch-report.html"><a href="mch-report.html#prenatal-care-initiation-by-maternal-age"><i class="fa fa-check"></i><b>2.4.1</b> Prenatal care initiation by maternal age</a></li>
<li class="chapter" data-level="2.4.2" data-path="mch-report.html"><a href="mch-report.html#prenatal-care-initiation-by-maternal-education"><i class="fa fa-check"></i><b>2.4.2</b> Prenatal care initiation by maternal education</a></li>
<li class="chapter" data-level="2.4.3" data-path="mch-report.html"><a href="mch-report.html#prenatal-care-initiation-by-marital-status"><i class="fa fa-check"></i><b>2.4.3</b> Prenatal care initiation by marital status</a></li>
<li class="chapter" data-level="2.4.4" data-path="mch-report.html"><a href="mch-report.html#prenatal-care-initiation-by-maternal-race-and-ethnicity"><i class="fa fa-check"></i><b>2.4.4</b> Prenatal care initiation by maternal race and ethnicity</a></li>
<li class="chapter" data-level="2.4.5" data-path="mch-report.html"><a href="mch-report.html#birthweight-by-prenatal-care-initiation"><i class="fa fa-check"></i><b>2.4.5</b> Birthweight by prenatal care initiation</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="mch-report.html"><a href="mch-report.html#exporting-data"><i class="fa fa-check"></i><b>2.5</b> Exporting data</a></li>
<li class="chapter" data-level="2.6" data-path="mch-report.html"><a href="mch-report.html#graphing-data"><i class="fa fa-check"></i><b>2.6</b> Graphing data</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="mch-report.html"><a href="mch-report.html#prenatal-care-initiation-by-maternal-age-1"><i class="fa fa-check"></i><b>2.6.1</b> Prenatal care initiation by maternal age</a></li>
<li class="chapter" data-level="2.6.2" data-path="mch-report.html"><a href="mch-report.html#prenatal-care-initiation-by-maternal-education-1"><i class="fa fa-check"></i><b>2.6.2</b> Prenatal care initiation by maternal education</a></li>
<li class="chapter" data-level="2.6.3" data-path="mch-report.html"><a href="mch-report.html#prenatal-care-initiation-by-marital-status-1"><i class="fa fa-check"></i><b>2.6.3</b> Prenatal care initiation by marital status</a></li>
<li class="chapter" data-level="2.6.4" data-path="mch-report.html"><a href="mch-report.html#prenatal-care-initiation-by-race-and-ethnicity"><i class="fa fa-check"></i><b>2.6.4</b> Prenatal care initiation by race and ethnicity</a></li>
<li class="chapter" data-level="2.6.5" data-path="mch-report.html"><a href="mch-report.html#birthweight-by-prenatal-care-initiation-1"><i class="fa fa-check"></i><b>2.6.5</b> Birthweight by prenatal care initiation</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="mch-report.html"><a href="mch-report.html#calculating-risk-ratios-for-early-prenatal-care"><i class="fa fa-check"></i><b>2.7</b> Calculating risk ratios for early prenatal care</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="mch-report.html"><a href="mch-report.html#risk-of-prenatal-care-initiation-by-maternal-age"><i class="fa fa-check"></i><b>2.7.1</b> Risk of prenatal care initiation by maternal age</a></li>
<li class="chapter" data-level="2.7.2" data-path="mch-report.html"><a href="mch-report.html#risk-of-prenatal-care-initiation-by-maternal-education"><i class="fa fa-check"></i><b>2.7.2</b> Risk of prenatal care initiation by maternal education</a></li>
<li class="chapter" data-level="2.7.3" data-path="mch-report.html"><a href="mch-report.html#risk-of-prenatal-care-initiation-by-marital-status"><i class="fa fa-check"></i><b>2.7.3</b> Risk of prenatal care initiation by marital status</a></li>
<li class="chapter" data-level="2.7.4" data-path="mch-report.html"><a href="mch-report.html#risk-of-prenatal-care-initiation-by-race-and-ethnicity"><i class="fa fa-check"></i><b>2.7.4</b> Risk of prenatal care initiation by race and ethnicity</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="mch-report.html"><a href="mch-report.html#final-notes-1"><i class="fa fa-check"></i><b>2.8</b> Final notes</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="stis.html"><a href="stis.html"><i class="fa fa-check"></i><b>3</b> STIs</a>
<ul>
<li class="chapter" data-level="3.1" data-path="stis.html"><a href="stis.html#libraries-2"><i class="fa fa-check"></i><b>3.1</b> Libraries</a></li>
<li class="chapter" data-level="3.2" data-path="stis.html"><a href="stis.html#importing-chlamydia-data"><i class="fa fa-check"></i><b>3.2</b> Importing chlamydia data</a></li>
<li class="chapter" data-level="3.3" data-path="stis.html"><a href="stis.html#filtering-data-to-exclude-non-wake-cases"><i class="fa fa-check"></i><b>3.3</b> Filtering data to exclude non-Wake cases</a></li>
<li class="chapter" data-level="3.4" data-path="stis.html"><a href="stis.html#loading-census-data"><i class="fa fa-check"></i><b>3.4</b> Loading census data</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="stis.html"><a href="stis.html#loading-age-data"><i class="fa fa-check"></i><b>3.4.1</b> Loading age data</a></li>
<li class="chapter" data-level="3.4.2" data-path="stis.html"><a href="stis.html#loading-race-and-ethnicity-data"><i class="fa fa-check"></i><b>3.4.2</b> Loading race and ethnicity data</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="stis.html"><a href="stis.html#tally-cases-by-group-and-calculate-incidence"><i class="fa fa-check"></i><b>3.5</b> Tally cases by group and calculate incidence</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="stis.html"><a href="stis.html#chlamydia-incidence-by-age-group"><i class="fa fa-check"></i><b>3.5.1</b> Chlamydia incidence by age group</a></li>
<li class="chapter" data-level="3.5.2" data-path="stis.html"><a href="stis.html#chlamydia-incidence-by-race"><i class="fa fa-check"></i><b>3.5.2</b> Chlamydia incidence by race</a></li>
<li class="chapter" data-level="3.5.3" data-path="stis.html"><a href="stis.html#chlamydia-count-by-municipality"><i class="fa fa-check"></i><b>3.5.3</b> Chlamydia count by municipality</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="stis.html"><a href="stis.html#graphing-chlamydia"><i class="fa fa-check"></i><b>3.6</b> Graphing chlamydia</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="stis.html"><a href="stis.html#chlamydia-incidence-by-age-group-1"><i class="fa fa-check"></i><b>3.6.1</b> Chlamydia incidence by age group</a></li>
<li class="chapter" data-level="3.6.2" data-path="stis.html"><a href="stis.html#chlamydia-incidence-by-race-1"><i class="fa fa-check"></i><b>3.6.2</b> Chlamydia incidence by race</a></li>
<li class="chapter" data-level="3.6.3" data-path="stis.html"><a href="stis.html#chlamydia-count-by-municipality-1"><i class="fa fa-check"></i><b>3.6.3</b> Chlamydia count by municipality</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="stis.html"><a href="stis.html#tallying-and-graphing-gonorrhea"><i class="fa fa-check"></i><b>3.7</b> Tallying and graphing gonorrhea</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="stis.html"><a href="stis.html#importing"><i class="fa fa-check"></i><b>3.7.1</b> Importing</a></li>
<li class="chapter" data-level="3.7.2" data-path="stis.html"><a href="stis.html#filtering"><i class="fa fa-check"></i><b>3.7.2</b> Filtering</a></li>
<li class="chapter" data-level="3.7.3" data-path="stis.html"><a href="stis.html#tallying"><i class="fa fa-check"></i><b>3.7.3</b> Tallying</a></li>
<li class="chapter" data-level="3.7.4" data-path="stis.html"><a href="stis.html#graphing-gonorrhea-incidence-by-age-group"><i class="fa fa-check"></i><b>3.7.4</b> Graphing gonorrhea incidence by age group</a></li>
<li class="chapter" data-level="3.7.5" data-path="stis.html"><a href="stis.html#graphing-gonorrhea-incidence-by-race"><i class="fa fa-check"></i><b>3.7.5</b> Graphing gonorrhea incidence by race</a></li>
<li class="chapter" data-level="3.7.6" data-path="stis.html"><a href="stis.html#graphing-gonorrhea-count-by-municipality"><i class="fa fa-check"></i><b>3.7.6</b> Graphing gonorrhea count by municipality</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="stis.html"><a href="stis.html#final-notes-2"><i class="fa fa-check"></i><b>3.8</b> Final notes</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html"><i class="fa fa-check"></i><b>4</b> Respiratory Viruses</a>
<ul>
<li class="chapter" data-level="4.1" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#header-content"><i class="fa fa-check"></i><b>4.1</b> Header content</a></li>
<li class="chapter" data-level="4.2" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#settings-and-setup"><i class="fa fa-check"></i><b>4.2</b> Settings and setup</a></li>
<li class="chapter" data-level="4.3" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#importing-data-1"><i class="fa fa-check"></i><b>4.3</b> Importing data</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#factors"><i class="fa fa-check"></i><b>4.3.1</b> Factors</a></li>
<li class="chapter" data-level="4.3.2" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#modifying-the-epi-year"><i class="fa fa-check"></i><b>4.3.2</b> Modifying the epi year</a></li>
<li class="chapter" data-level="4.3.3" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#reading-the-files"><i class="fa fa-check"></i><b>4.3.3</b> Reading the files</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#highlights-slide"><i class="fa fa-check"></i><b>4.4</b> Highlights slide</a></li>
<li class="chapter" data-level="4.5" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#graphing"><i class="fa fa-check"></i><b>4.5</b> Graphing</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#ili-counts-by-week"><i class="fa fa-check"></i><b>4.5.1</b> ILI counts by week</a></li>
<li class="chapter" data-level="4.5.2" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#ili-counts-by-age-group"><i class="fa fa-check"></i><b>4.5.2</b> ILI counts by age group</a></li>
<li class="chapter" data-level="4.5.3" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#ili-proportions-by-age-group"><i class="fa fa-check"></i><b>4.5.3</b> ILI proportions by age group</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#rendering-and-formatting"><i class="fa fa-check"></i><b>4.6</b> Rendering and formatting</a></li>
<li class="chapter" data-level="4.7" data-path="respiratory-viruses.html"><a href="respiratory-viruses.html#final-notes-3"><i class="fa fa-check"></i><b>4.7</b> Final notes</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bookdown.html"><a href="bookdown.html"><i class="fa fa-check"></i><b>5</b> Bookdown</a>
<ul>
<li class="chapter" data-level="5.1" data-path="bookdown.html"><a href="bookdown.html#file-structure"><i class="fa fa-check"></i><b>5.1</b> File structure</a></li>
<li class="chapter" data-level="5.2" data-path="bookdown.html"><a href="bookdown.html#bookdown-package"><i class="fa fa-check"></i><b>5.2</b> Bookdown package</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Created with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">In-Service Presentation, August 2024</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="stis" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Section 3</span> STIs<a href="stis.html#stis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>As a local health department, WCHHS has access to the North Carolina Electronic Disease Surveillance System (NC EDSS), which is a database that includes every case of a reportable condition in North Carolina. NC EDSS can generate a line list of every case of a reportable disease.</p>
<p>For this section of the presentation, I’ve generated new graphics from line list data for chlamydia and gonorrhea, which are two of the top ten reportable conditions in Wake County and part of a concerning trend of increasing STI cases nationwide. The graphics display incidence proportions of chlamydia and gonorrhea over the last five years, stratified by age group, race, and municipality. Before the code for the graphs, I will walk through the process of filtering data to systematically exclude non-Wake cases and creating a <code>City_guess</code> variable to guess the municipality in case of typos.</p>
<p>The data used for these reports is confidential and cannot be exported, so this portion of the presentation cannot be regenerated outside WCHHS systems. However, if you have access to the WCHHS Epidemiology SharePoint site, you can tweak and regenerate these graphs.</p>
<div id="libraries-2" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Libraries<a href="stis.html#libraries-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="stis.html#cb40-1" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(ezepi))</span>
<span id="cb40-2"><a href="stis.html#cb40-2" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(stringdist))</span></code></pre></div>
<p>There are three non-standard libraries used in this script.</p>
<ol style="list-style-type: decimal">
<li><code>ezepi</code>, which I wrote outside of the practicum, is loaded here to use some specific functions I wrote for cleanliness. If you would like to use it, you can find installation instructions on <a href="https://github.com/alectries/ezepi">its GitHub page</a>.</li>
<li><code>tidyverse</code>, which is loaded here by the <code>ezepi</code> call.</li>
<li><code>stringdist</code>, short for string distance, which gives methods to evaluate how “distant” a <em>string</em> (a character value) is from another string.</li>
</ol>
</div>
<div id="importing-chlamydia-data" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Importing chlamydia data<a href="stis.html#importing-chlamydia-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now, we import the data. The data are stored in ten separate .csv files: one for each year and disease. These files are slightly modified from the NC EDSS line list outputs to remove a few lines of unnecessary headers and the footnote at the bottom.</p>
<p>First, we define the list of tables and write a function to import them all at once.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="stis.html#cb41-1" tabindex="-1"></a><span class="co"># List tables to import</span></span>
<span id="cb41-2"><a href="stis.html#cb41-2" tabindex="-1"></a>tables <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;chla19&quot;</span>, <span class="st">&quot;chla20&quot;</span>, <span class="st">&quot;chla21&quot;</span>, <span class="st">&quot;chla22&quot;</span>, <span class="st">&quot;chla23&quot;</span>)</span>
<span id="cb41-3"><a href="stis.html#cb41-3" tabindex="-1"></a></span>
<span id="cb41-4"><a href="stis.html#cb41-4" tabindex="-1"></a><span class="co"># Create a reader function</span></span>
<span id="cb41-5"><a href="stis.html#cb41-5" tabindex="-1"></a>sesh_read <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb41-6"><a href="stis.html#cb41-6" tabindex="-1"></a>  <span class="fu">read_csv</span>(</span>
<span id="cb41-7"><a href="stis.html#cb41-7" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">&quot;../Data/&quot;</span>, x, <span class="st">&quot;.csv&quot;</span>),                        <span class="co"># Specify the file path</span></span>
<span id="cb41-8"><a href="stis.html#cb41-8" tabindex="-1"></a>    <span class="at">show_col_types =</span> <span class="cn">FALSE</span>,                               <span class="co"># Prevent unnecessary output</span></span>
<span id="cb41-9"><a href="stis.html#cb41-9" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="st">&quot;ncccccccncccccccccncccccccccccccccccncc&quot;</span> <span class="co"># Define column types in data</span></span>
<span id="cb41-10"><a href="stis.html#cb41-10" tabindex="-1"></a>  )</span>
<span id="cb41-11"><a href="stis.html#cb41-11" tabindex="-1"></a>}</span></code></pre></div>
<p>With in <code>read_csv()</code>, we’re performing two notable tasks:</p>
<ol style="list-style-type: decimal">
<li>Using <code>paste0()</code> to add the folder (go up one folder, then into Data) and file extension (.csv) to the file name (<code>x</code>).</li>
<li>Defining the column types. We define a few as numeric, such as the Event ID and the patient age, but we set most to character, including dates and ZIP codes. We’ll fix dates in another step.</li>
</ol>
<p>Next, we use this function to import the data, then combine the five Chlamydia tables and fix some variables.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="stis.html#cb42-1" tabindex="-1"></a><span class="co"># Apply the sesh_read function to the list of tables (importing five tables)</span></span>
<span id="cb42-2"><a href="stis.html#cb42-2" tabindex="-1"></a>chla <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb42-3"><a href="stis.html#cb42-3" tabindex="-1"></a>  tables, sesh_read</span>
<span id="cb42-4"><a href="stis.html#cb42-4" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-5"><a href="stis.html#cb42-5" tabindex="-1"></a>  </span>
<span id="cb42-6"><a href="stis.html#cb42-6" tabindex="-1"></a>  <span class="co"># Combine the five tables into one</span></span>
<span id="cb42-7"><a href="stis.html#cb42-7" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-8"><a href="stis.html#cb42-8" tabindex="-1"></a>  </span>
<span id="cb42-9"><a href="stis.html#cb42-9" tabindex="-1"></a>  <span class="co"># Alter some variables</span></span>
<span id="cb42-10"><a href="stis.html#cb42-10" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-11"><a href="stis.html#cb42-11" tabindex="-1"></a>    <span class="st">&quot;Create Date&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Create Date</span><span class="st">`</span>), <span class="co"># `mdy` tells R this is a date in month-day-year format</span></span>
<span id="cb42-12"><a href="stis.html#cb42-12" tabindex="-1"></a>    <span class="st">&quot;Birthdate&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Birthdate</span><span class="st">`</span>),</span>
<span id="cb42-13"><a href="stis.html#cb42-13" tabindex="-1"></a>    <span class="st">&quot;City&quot;</span> <span class="ot">=</span> <span class="fu">toupper</span>(City), <span class="co"># `toupper` changes the cities to all uppercase</span></span>
<span id="cb42-14"><a href="stis.html#cb42-14" tabindex="-1"></a>    <span class="st">&quot;Symptom Onset Date&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Symptom Onset Date</span><span class="st">`</span>),</span>
<span id="cb42-15"><a href="stis.html#cb42-15" tabindex="-1"></a>    <span class="st">&quot;Reporting Date to CDC&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Reporting Date to CDC</span><span class="st">`</span>),</span>
<span id="cb42-16"><a href="stis.html#cb42-16" tabindex="-1"></a>    <span class="st">&quot;Diagnosis Date&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Diagnosis Date</span><span class="st">`</span>),</span>
<span id="cb42-17"><a href="stis.html#cb42-17" tabindex="-1"></a>    <span class="st">&quot;Date Initial Report to PH&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Date Initial Report to PH</span><span class="st">`</span>),</span>
<span id="cb42-18"><a href="stis.html#cb42-18" tabindex="-1"></a>    <span class="st">&quot;Date Identified as Contact&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Date Identified as Contact</span><span class="st">`</span>),</span>
<span id="cb42-19"><a href="stis.html#cb42-19" tabindex="-1"></a>    <span class="st">&quot;Specimen Date&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Specimen Date</span><span class="st">`</span>),</span>
<span id="cb42-20"><a href="stis.html#cb42-20" tabindex="-1"></a>    <span class="st">&quot;MMWR Date&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">MMWR Date</span><span class="st">`</span>),</span>
<span id="cb42-21"><a href="stis.html#cb42-21" tabindex="-1"></a>    <span class="st">&quot;Zip&quot;</span> <span class="ot">=</span> <span class="fu">str_sub</span>(Zip, <span class="dv">1</span>, <span class="dv">5</span>) <span class="co"># `str_sub` cuts ZIP codes down to just the first five digits</span></span>
<span id="cb42-22"><a href="stis.html#cb42-22" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb42-23"><a href="stis.html#cb42-23" tabindex="-1"></a>  </span>
<span id="cb42-24"><a href="stis.html#cb42-24" tabindex="-1"></a>  <span class="co"># Change the name of the Zip variable to ZIP</span></span>
<span id="cb42-25"><a href="stis.html#cb42-25" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ZIP =</span> Zip)</span></code></pre></div>
<p>Notice the use of the pipe (<code>%&gt;%</code>) here: we perform several functions on the imported data and assign (with <code>&lt;-</code>) the final product of our full expression to <code>chla</code> in the first row.</p>
<p>See the code comments for explanations of what individual lines are doing.</p>
</div>
<div id="filtering-data-to-exclude-non-wake-cases" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Filtering data to exclude non-Wake cases<a href="stis.html#filtering-data-to-exclude-non-wake-cases" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>WCHHS, as a very large metropolitan health department, frequently provides STI testing to clients who live outside Wake County. All test results performed in Wake, regardless of the patient’s county of residence, are reported to Wake County through NC EDSS. To analyze trends in Wake alone, we need to systematically filter out non-Wake cases.</p>
<p>In this script, to filter out non-Wake cases, I used three fields: reported county, ZIP, and city. Cases needed to have a match in at least one of these three fields to be included. For County, only Wake County (or NA) was accepted. For City and ZIP, this code was used:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="stis.html#cb43-1" tabindex="-1"></a><span class="co"># Pull the list of accepted ZIP codes from wake_zips.csv</span></span>
<span id="cb43-2"><a href="stis.html#cb43-2" tabindex="-1"></a>zips <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;wake_zips.csv&quot;</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>, <span class="at">col_types =</span> <span class="st">&quot;c&quot;</span>)</span>
<span id="cb43-3"><a href="stis.html#cb43-3" tabindex="-1"></a></span>
<span id="cb43-4"><a href="stis.html#cb43-4" tabindex="-1"></a><span class="co"># Set the list of accepted cities</span></span>
<span id="cb43-5"><a href="stis.html#cb43-5" tabindex="-1"></a>cities <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Apex&quot;</span>, <span class="st">&quot;Cary&quot;</span>, <span class="st">&quot;Fuquay&quot;</span>, <span class="st">&quot;Fuquay-Varina&quot;</span>, <span class="st">&quot;Garner&quot;</span>,</span>
<span id="cb43-6"><a href="stis.html#cb43-6" tabindex="-1"></a>            <span class="st">&quot;Holly Springs&quot;</span>, <span class="st">&quot;Knightdale&quot;</span>, <span class="st">&quot;Morrisville&quot;</span>, <span class="st">&quot;Raleigh&quot;</span>,</span>
<span id="cb43-7"><a href="stis.html#cb43-7" tabindex="-1"></a>            <span class="st">&quot;Rolesville&quot;</span>, <span class="st">&quot;Wake Forest&quot;</span>, <span class="st">&quot;Wendell&quot;</span>, <span class="st">&quot;Zebulon&quot;</span>,</span>
<span id="cb43-8"><a href="stis.html#cb43-8" tabindex="-1"></a>            <span class="st">&quot;Durham&quot;</span>, <span class="st">&quot;Angier&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-9"><a href="stis.html#cb43-9" tabindex="-1"></a>  </span>
<span id="cb43-10"><a href="stis.html#cb43-10" tabindex="-1"></a>  <span class="co"># Convert the list to uppercase (to match the City field in the data)</span></span>
<span id="cb43-11"><a href="stis.html#cb43-11" tabindex="-1"></a>  <span class="fu">toupper</span>()</span></code></pre></div>
<p>Next, we write the function to filter the data.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="stis.html#cb44-1" tabindex="-1"></a>chla_filtered <span class="ot">&lt;-</span> chla <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="stis.html#cb44-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-3"><a href="stis.html#cb44-3" tabindex="-1"></a>    </span>
<span id="cb44-4"><a href="stis.html#cb44-4" tabindex="-1"></a>    <span class="co"># Create the &quot;del&quot; (delete) variable to mark cases for deletion</span></span>
<span id="cb44-5"><a href="stis.html#cb44-5" tabindex="-1"></a>    <span class="st">&quot;del&quot;</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb44-6"><a href="stis.html#cb44-6" tabindex="-1"></a>      </span>
<span id="cb44-7"><a href="stis.html#cb44-7" tabindex="-1"></a>      <span class="co"># If county is not Wake or NA, mark for deletion</span></span>
<span id="cb44-8"><a href="stis.html#cb44-8" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(County) <span class="sc">&amp;</span> County <span class="sc">!=</span> <span class="st">&quot;Wake County&quot;</span> <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb44-9"><a href="stis.html#cb44-9" tabindex="-1"></a>      </span>
<span id="cb44-10"><a href="stis.html#cb44-10" tabindex="-1"></a>      <span class="co"># If ZIP is not a Wake ZIP or NA and the county is not given, mark for deletion</span></span>
<span id="cb44-11"><a href="stis.html#cb44-11" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(ZIP) <span class="sc">&amp;</span> <span class="sc">!</span>(ZIP <span class="sc">%in%</span> zips<span class="sc">$</span>ZIP) <span class="sc">&amp;</span> <span class="fu">is.na</span>(County) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb44-12"><a href="stis.html#cb44-12" tabindex="-1"></a>      </span>
<span id="cb44-13"><a href="stis.html#cb44-13" tabindex="-1"></a>      <span class="co"># If city is not a Wake municipality or NA and the county is not given, mark for deletion</span></span>
<span id="cb44-14"><a href="stis.html#cb44-14" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(City) <span class="sc">&amp;</span> <span class="sc">!</span>(</span>
<span id="cb44-15"><a href="stis.html#cb44-15" tabindex="-1"></a>        <span class="fu">stringdistmatrix</span>(chla<span class="sc">$</span>City, cities, <span class="at">method =</span> <span class="st">&quot;lv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-16"><a href="stis.html#cb44-16" tabindex="-1"></a>          <span class="fu">apply</span>(<span class="dv">1</span>, <span class="cf">function</span>(row){<span class="fu">any</span>(row <span class="sc">&lt;=</span> <span class="dv">5</span>)})</span>
<span id="cb44-17"><a href="stis.html#cb44-17" tabindex="-1"></a>      ) <span class="sc">&amp;</span> <span class="fu">is.na</span>(County) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb44-18"><a href="stis.html#cb44-18" tabindex="-1"></a>      </span>
<span id="cb44-19"><a href="stis.html#cb44-19" tabindex="-1"></a>      <span class="co"># If county, ZIP, and city are all NA, mark for deletion</span></span>
<span id="cb44-20"><a href="stis.html#cb44-20" tabindex="-1"></a>      <span class="fu">is.na</span>(County) <span class="sc">&amp;</span> <span class="fu">is.na</span>(ZIP) <span class="sc">&amp;</span> <span class="fu">is.na</span>(City) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb44-21"><a href="stis.html#cb44-21" tabindex="-1"></a>      </span>
<span id="cb44-22"><a href="stis.html#cb44-22" tabindex="-1"></a>      <span class="co"># Otherwise, mark to keep</span></span>
<span id="cb44-23"><a href="stis.html#cb44-23" tabindex="-1"></a>      <span class="at">.default =</span> <span class="cn">FALSE</span></span>
<span id="cb44-24"><a href="stis.html#cb44-24" tabindex="-1"></a>    ),</span>
<span id="cb44-25"><a href="stis.html#cb44-25" tabindex="-1"></a>    </span>
<span id="cb44-26"><a href="stis.html#cb44-26" tabindex="-1"></a>    <span class="co"># Create a variable that guesses (fixes typos in) the city column</span></span>
<span id="cb44-27"><a href="stis.html#cb44-27" tabindex="-1"></a>    <span class="st">&quot;City_guess&quot;</span> <span class="ot">=</span> <span class="fu">map_chr</span>(City, <span class="cf">function</span>(city){</span>
<span id="cb44-28"><a href="stis.html#cb44-28" tabindex="-1"></a>      </span>
<span id="cb44-29"><a href="stis.html#cb44-29" tabindex="-1"></a>      <span class="co"># If the city is in Wake and spelled correctly, keep it as is</span></span>
<span id="cb44-30"><a href="stis.html#cb44-30" tabindex="-1"></a>      <span class="cf">if</span>(city <span class="sc">%in%</span> cities){</span>
<span id="cb44-31"><a href="stis.html#cb44-31" tabindex="-1"></a>        <span class="fu">return</span>(city)</span>
<span id="cb44-32"><a href="stis.html#cb44-32" tabindex="-1"></a>        </span>
<span id="cb44-33"><a href="stis.html#cb44-33" tabindex="-1"></a>        <span class="co"># If there is no city given, don&#39;t guess (say NA)</span></span>
<span id="cb44-34"><a href="stis.html#cb44-34" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">is.na</span>(city)){</span>
<span id="cb44-35"><a href="stis.html#cb44-35" tabindex="-1"></a>        <span class="fu">return</span>(<span class="cn">NA_character_</span>)</span>
<span id="cb44-36"><a href="stis.html#cb44-36" tabindex="-1"></a>        </span>
<span id="cb44-37"><a href="stis.html#cb44-37" tabindex="-1"></a>        <span class="co"># Otherwise, compare to Wake cities and pick the best match</span></span>
<span id="cb44-38"><a href="stis.html#cb44-38" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb44-39"><a href="stis.html#cb44-39" tabindex="-1"></a>      distances <span class="ot">&lt;-</span> <span class="fu">stringdist</span>(city, cities, <span class="at">method =</span> <span class="st">&quot;lv&quot;</span>)</span>
<span id="cb44-40"><a href="stis.html#cb44-40" tabindex="-1"></a>      best_match <span class="ot">&lt;-</span> cities[<span class="fu">which.min</span>(distances)]</span>
<span id="cb44-41"><a href="stis.html#cb44-41" tabindex="-1"></a>      <span class="fu">return</span>(best_match)</span>
<span id="cb44-42"><a href="stis.html#cb44-42" tabindex="-1"></a>      }</span>
<span id="cb44-43"><a href="stis.html#cb44-43" tabindex="-1"></a>    })</span>
<span id="cb44-44"><a href="stis.html#cb44-44" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb44-45"><a href="stis.html#cb44-45" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-46"><a href="stis.html#cb44-46" tabindex="-1"></a>    </span>
<span id="cb44-47"><a href="stis.html#cb44-47" tabindex="-1"></a>    <span class="co"># Make manual edits to the city guess</span></span>
<span id="cb44-48"><a href="stis.html#cb44-48" tabindex="-1"></a>    <span class="st">&quot;City_guess&quot;</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb44-49"><a href="stis.html#cb44-49" tabindex="-1"></a>      </span>
<span id="cb44-50"><a href="stis.html#cb44-50" tabindex="-1"></a>      <span class="co"># If the city isn&#39;t given in the data, set the guess to &quot;OTHER&quot;</span></span>
<span id="cb44-51"><a href="stis.html#cb44-51" tabindex="-1"></a>      <span class="fu">is.na</span>(City) <span class="sc">~</span> <span class="st">&quot;OTHER&quot;</span>,</span>
<span id="cb44-52"><a href="stis.html#cb44-52" tabindex="-1"></a>      </span>
<span id="cb44-53"><a href="stis.html#cb44-53" tabindex="-1"></a>      <span class="co"># If the city guess was Fuquay (common shorthand), use the full name</span></span>
<span id="cb44-54"><a href="stis.html#cb44-54" tabindex="-1"></a>      City_guess <span class="sc">==</span> <span class="st">&quot;FUQUAY&quot;</span> <span class="sc">~</span> <span class="st">&quot;FUQUAY-VARINA&quot;</span>,</span>
<span id="cb44-55"><a href="stis.html#cb44-55" tabindex="-1"></a>      </span>
<span id="cb44-56"><a href="stis.html#cb44-56" tabindex="-1"></a>      <span class="co"># If the city was Wake, set the guess to &quot;OTHER&quot;</span></span>
<span id="cb44-57"><a href="stis.html#cb44-57" tabindex="-1"></a>      City <span class="sc">==</span> <span class="st">&quot;WAKE&quot;</span> <span class="sc">~</span> <span class="st">&quot;OTHER&quot;</span>,</span>
<span id="cb44-58"><a href="stis.html#cb44-58" tabindex="-1"></a>      </span>
<span id="cb44-59"><a href="stis.html#cb44-59" tabindex="-1"></a>      <span class="co"># If the city was RaleighRaleigh (common typo), set the guess to &quot;RALEIGH&quot;</span></span>
<span id="cb44-60"><a href="stis.html#cb44-60" tabindex="-1"></a>      City <span class="sc">==</span> <span class="st">&quot;RALEIGHRALEIGH&quot;</span> <span class="sc">~</span> <span class="st">&quot;RALEIGH&quot;</span>,</span>
<span id="cb44-61"><a href="stis.html#cb44-61" tabindex="-1"></a>      </span>
<span id="cb44-62"><a href="stis.html#cb44-62" tabindex="-1"></a>      <span class="co"># If the guess is too different from the original, set the guess to &quot;OTHER&quot;</span></span>
<span id="cb44-63"><a href="stis.html#cb44-63" tabindex="-1"></a>      <span class="fu">stringdist</span>(City, City_guess, <span class="at">method =</span> <span class="st">&quot;lv&quot;</span>) <span class="sc">&gt;</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">&quot;OTHER&quot;</span>,</span>
<span id="cb44-64"><a href="stis.html#cb44-64" tabindex="-1"></a>      </span>
<span id="cb44-65"><a href="stis.html#cb44-65" tabindex="-1"></a>      <span class="co"># If none of the above apply, do not alter the guess</span></span>
<span id="cb44-66"><a href="stis.html#cb44-66" tabindex="-1"></a>      <span class="at">.default =</span> City_guess</span>
<span id="cb44-67"><a href="stis.html#cb44-67" tabindex="-1"></a>    )</span>
<span id="cb44-68"><a href="stis.html#cb44-68" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb44-69"><a href="stis.html#cb44-69" tabindex="-1"></a>  </span>
<span id="cb44-70"><a href="stis.html#cb44-70" tabindex="-1"></a>  <span class="co"># Move the guess variable next to the city variable in the data (for convenience)</span></span>
<span id="cb44-71"><a href="stis.html#cb44-71" tabindex="-1"></a>  <span class="fu">relocate</span>(City_guess, <span class="at">.after =</span> City) <span class="sc">%&gt;%</span> </span>
<span id="cb44-72"><a href="stis.html#cb44-72" tabindex="-1"></a>  </span>
<span id="cb44-73"><a href="stis.html#cb44-73" tabindex="-1"></a>  <span class="co"># Filter cases, keeping only those NOT marked for deletion</span></span>
<span id="cb44-74"><a href="stis.html#cb44-74" tabindex="-1"></a>  <span class="fu">filter</span>(del <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-75"><a href="stis.html#cb44-75" tabindex="-1"></a>  </span>
<span id="cb44-76"><a href="stis.html#cb44-76" tabindex="-1"></a>  <span class="co"># Remove the deletion marker variable</span></span>
<span id="cb44-77"><a href="stis.html#cb44-77" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>del)</span></code></pre></div>
<p>See the comments in the above code for a complete description of its function. Some key notes about the use of <code>stringdist</code> to guess and match cities:</p>
<ol style="list-style-type: decimal">
<li><code>stringdist</code> has multiple algorithm options. For this task, I used Levenshtein distance (<code>lv</code>), which simply counts the number of deletions, insertions, and substitutions needed to convert one string to another.</li>
<li>When marking cases for deletion, I chose to set the maximum distance between the city and the nearest guess to 5. This was chosen through trial and error with the data and is arbitrary; use whatever cutoff works best on the data you’re working with.</li>
<li>When guessing the closest city, however, I chose a cutoff of 3. Again, this was based on trial and error. A more specific cutoff for the city guess is sensible because it only impacts how data is classified, not whether it is included.</li>
</ol>
<p>Additionally, because it is somewhat hard to parse, here is the logic (in words) for how cases are selected for deletion:</p>
<p>IF…</p>
<ol style="list-style-type: decimal">
<li>the county is defined but is not Wake, THEN delete (set <code>del</code> to TRUE).</li>
<li>the ZIP is defined but is not in <code>wake_zips</code> AND the county is undefined, THEN delete.</li>
<li>the city is defined but is not within 5 substitutions, insertions, and deletions of any municipality in <code>cities</code> AND the county is undefined, THEN delete.</li>
<li>the county, ZIP code, and city are all undefined, THEN delete.</li>
<li>ELSE keep the case (set <code>del</code> to FALSE).</li>
</ol>
</div>
<div id="loading-census-data" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Loading census data<a href="stis.html#loading-census-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Next, we need to load census data for age and race/ethnicity to calculate incidence. The included <code>census_18-22.csv</code> spreadsheet is a combination of ACS<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> and Census<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> demographic data from 2018-2022. Data has been manually combined and calculated (where possible) so that the differing fields between the ACS and Census are comparable.</p>
<div id="loading-age-data" class="section level3 hasAnchor" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Loading age data<a href="stis.html#loading-age-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="stis.html#cb45-1" tabindex="-1"></a><span class="co"># Read in the spreadsheet and set all column types to character</span></span>
<span id="cb45-2"><a href="stis.html#cb45-2" tabindex="-1"></a>census_age <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;census_18-22.csv&quot;</span>,</span>
<span id="cb45-3"><a href="stis.html#cb45-3" tabindex="-1"></a>                       <span class="at">col_types =</span> <span class="st">&quot;cccccc&quot;</span>,</span>
<span id="cb45-4"><a href="stis.html#cb45-4" tabindex="-1"></a>                       <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-5"><a href="stis.html#cb45-5" tabindex="-1"></a>  </span>
<span id="cb45-6"><a href="stis.html#cb45-6" tabindex="-1"></a>  <span class="co"># Select only the rows with age data</span></span>
<span id="cb45-7"><a href="stis.html#cb45-7" tabindex="-1"></a>  <span class="fu">slice</span>(., <span class="dv">6</span><span class="sc">:</span><span class="dv">28</span>, <span class="dv">30</span><span class="sc">:</span><span class="dv">35</span>, <span class="dv">43</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-8"><a href="stis.html#cb45-8" tabindex="-1"></a>  </span>
<span id="cb45-9"><a href="stis.html#cb45-9" tabindex="-1"></a>  <span class="co"># Remove the comma separators from numbers and set them to numeric</span></span>
<span id="cb45-10"><a href="stis.html#cb45-10" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-11"><a href="stis.html#cb45-11" tabindex="-1"></a>    <span class="st">&quot;2018&quot;</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove_all</span>(<span class="st">`</span><span class="at">2018</span><span class="st">`</span>, <span class="st">&quot;,&quot;</span>)),</span>
<span id="cb45-12"><a href="stis.html#cb45-12" tabindex="-1"></a>    <span class="st">&quot;2019&quot;</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove_all</span>(<span class="st">`</span><span class="at">2019</span><span class="st">`</span>, <span class="st">&quot;,&quot;</span>)),</span>
<span id="cb45-13"><a href="stis.html#cb45-13" tabindex="-1"></a>    <span class="st">&quot;2020&quot;</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove_all</span>(<span class="st">`</span><span class="at">2020</span><span class="st">`</span>, <span class="st">&quot;,&quot;</span>)),</span>
<span id="cb45-14"><a href="stis.html#cb45-14" tabindex="-1"></a>    <span class="st">&quot;2021&quot;</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove_all</span>(<span class="st">`</span><span class="at">2021</span><span class="st">`</span>, <span class="st">&quot;,&quot;</span>)),</span>
<span id="cb45-15"><a href="stis.html#cb45-15" tabindex="-1"></a>    <span class="st">&quot;2022&quot;</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove_all</span>(<span class="st">`</span><span class="at">2022</span><span class="st">`</span>, <span class="st">&quot;,&quot;</span>))</span>
<span id="cb45-16"><a href="stis.html#cb45-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb45-17"><a href="stis.html#cb45-17" tabindex="-1"></a>  </span>
<span id="cb45-18"><a href="stis.html#cb45-18" tabindex="-1"></a>  <span class="co"># Define and calculate population totals for custom age groups</span></span>
<span id="cb45-19"><a href="stis.html#cb45-19" tabindex="-1"></a>  <span class="fu">mutate_rows</span>(</span>
<span id="cb45-20"><a href="stis.html#cb45-20" tabindex="-1"></a>    <span class="st">&quot;5 to 17 years&quot;</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Total population</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">18 years and over</span><span class="st">`</span>,</span>
<span id="cb45-21"><a href="stis.html#cb45-21" tabindex="-1"></a>    <span class="st">&quot;18 to 24 years&quot;</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Under 5 years</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">5 to 9 years</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">10 to 14 years</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">15 to 19 years</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">20 to 24 years</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">Under 18 years</span><span class="st">`</span>,</span>
<span id="cb45-22"><a href="stis.html#cb45-22" tabindex="-1"></a>    <span class="st">&quot;25 to 44 years&quot;</span> <span class="ot">=</span> <span class="st">`</span><span class="at">25 to 34 years</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">35 to 44 years</span><span class="st">`</span>,</span>
<span id="cb45-23"><a href="stis.html#cb45-23" tabindex="-1"></a>    <span class="st">&quot;45 to 64 years&quot;</span> <span class="ot">=</span> <span class="st">`</span><span class="at">45 to 54 years</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">55 to 59 years</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">60 to 64 years</span><span class="st">`</span></span>
<span id="cb45-24"><a href="stis.html#cb45-24" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb45-25"><a href="stis.html#cb45-25" tabindex="-1"></a>  </span>
<span id="cb45-26"><a href="stis.html#cb45-26" tabindex="-1"></a>  <span class="co"># Add a column for 2023 with the same population as 2022</span></span>
<span id="cb45-27"><a href="stis.html#cb45-27" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&quot;2023&quot;</span> <span class="ot">=</span> <span class="st">`</span><span class="at">2022</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-28"><a href="stis.html#cb45-28" tabindex="-1"></a>  </span>
<span id="cb45-29"><a href="stis.html#cb45-29" tabindex="-1"></a>  <span class="co"># Pivot the dataset to merge later</span></span>
<span id="cb45-30"><a href="stis.html#cb45-30" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb45-31"><a href="stis.html#cb45-31" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>Label,</span>
<span id="cb45-32"><a href="stis.html#cb45-32" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb45-33"><a href="stis.html#cb45-33" tabindex="-1"></a>    <span class="at">names_transform =</span> as.numeric,</span>
<span id="cb45-34"><a href="stis.html#cb45-34" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;Population&quot;</span></span>
<span id="cb45-35"><a href="stis.html#cb45-35" tabindex="-1"></a>  )</span></code></pre></div>
<p>See the comments in the code for specific steps. One note: <code>mutate_rows()</code>, though it looks like a <code>tidyverse</code> function, is actually an <code>ezepi</code> function. Make sure to load <code>ezepi</code> if you want to use it in other scripts.</p>
</div>
<div id="loading-race-and-ethnicity-data" class="section level3 hasAnchor" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Loading race and ethnicity data<a href="stis.html#loading-race-and-ethnicity-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="stis.html#cb46-1" tabindex="-1"></a>census_raceth <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;census_18-22.csv&quot;</span>,</span>
<span id="cb46-2"><a href="stis.html#cb46-2" tabindex="-1"></a>                          <span class="at">col_types =</span> <span class="st">&quot;cccccc&quot;</span>,</span>
<span id="cb46-3"><a href="stis.html#cb46-3" tabindex="-1"></a>                          <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="stis.html#cb46-4" tabindex="-1"></a>  <span class="fu">slice</span>(., <span class="dv">43</span><span class="sc">:</span><span class="dv">48</span>, <span class="dv">53</span>, <span class="dv">61</span>, <span class="dv">66</span>, <span class="dv">80</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-5"><a href="stis.html#cb46-5" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb46-6"><a href="stis.html#cb46-6" tabindex="-1"></a>    <span class="st">&quot;2018&quot;</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove_all</span>(<span class="st">`</span><span class="at">2018</span><span class="st">`</span>, <span class="st">&quot;,&quot;</span>)),</span>
<span id="cb46-7"><a href="stis.html#cb46-7" tabindex="-1"></a>    <span class="st">&quot;2019&quot;</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove_all</span>(<span class="st">`</span><span class="at">2019</span><span class="st">`</span>, <span class="st">&quot;,&quot;</span>)),</span>
<span id="cb46-8"><a href="stis.html#cb46-8" tabindex="-1"></a>    <span class="st">&quot;2020&quot;</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove_all</span>(<span class="st">`</span><span class="at">2020</span><span class="st">`</span>, <span class="st">&quot;,&quot;</span>)),</span>
<span id="cb46-9"><a href="stis.html#cb46-9" tabindex="-1"></a>    <span class="st">&quot;2021&quot;</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove_all</span>(<span class="st">`</span><span class="at">2021</span><span class="st">`</span>, <span class="st">&quot;,&quot;</span>)),</span>
<span id="cb46-10"><a href="stis.html#cb46-10" tabindex="-1"></a>    <span class="st">&quot;2022&quot;</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove_all</span>(<span class="st">`</span><span class="at">2022</span><span class="st">`</span>, <span class="st">&quot;,&quot;</span>))</span>
<span id="cb46-11"><a href="stis.html#cb46-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb46-12"><a href="stis.html#cb46-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&quot;2023&quot;</span> <span class="ot">=</span> <span class="st">`</span><span class="at">2022</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-13"><a href="stis.html#cb46-13" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb46-14"><a href="stis.html#cb46-14" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>Label,</span>
<span id="cb46-15"><a href="stis.html#cb46-15" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb46-16"><a href="stis.html#cb46-16" tabindex="-1"></a>    <span class="at">names_transform =</span> as.numeric,</span>
<span id="cb46-17"><a href="stis.html#cb46-17" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;Population&quot;</span></span>
<span id="cb46-18"><a href="stis.html#cb46-18" tabindex="-1"></a>  )</span></code></pre></div>
<p>This section is similar to the above section, so comments are not included.</p>
</div>
</div>
<div id="tally-cases-by-group-and-calculate-incidence" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Tally cases by group and calculate incidence<a href="stis.html#tally-cases-by-group-and-calculate-incidence" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now, we need to group and count the line list data by age, race, and municipality. We will calculate incidence for age and race and display counts for municipality.</p>
<div id="chlamydia-incidence-by-age-group" class="section level3 hasAnchor" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> Chlamydia incidence by age group<a href="stis.html#chlamydia-incidence-by-age-group" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>First, we’ll do this by age group.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="stis.html#cb47-1" tabindex="-1"></a><span class="co"># Start with the filtered data</span></span>
<span id="cb47-2"><a href="stis.html#cb47-2" tabindex="-1"></a>chla_age <span class="ot">&lt;-</span> chla_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="stis.html#cb47-3" tabindex="-1"></a>  </span>
<span id="cb47-4"><a href="stis.html#cb47-4" tabindex="-1"></a>  <span class="co"># Create some variables</span></span>
<span id="cb47-5"><a href="stis.html#cb47-5" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb47-6"><a href="stis.html#cb47-6" tabindex="-1"></a>    </span>
<span id="cb47-7"><a href="stis.html#cb47-7" tabindex="-1"></a>    <span class="co"># Variable for census age groups (5/10 year groups)</span></span>
<span id="cb47-8"><a href="stis.html#cb47-8" tabindex="-1"></a>    <span class="at">census_age =</span> <span class="fu">factor</span>(</span>
<span id="cb47-9"><a href="stis.html#cb47-9" tabindex="-1"></a>      <span class="co"># Use `case_when()` (see note) to determine the values</span></span>
<span id="cb47-10"><a href="stis.html#cb47-10" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">case_when</span>(</span>
<span id="cb47-11"><a href="stis.html#cb47-11" tabindex="-1"></a>        Age <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">&quot;Under 5 years&quot;</span>,</span>
<span id="cb47-12"><a href="stis.html#cb47-12" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">&quot;5 to 9 years&quot;</span>,</span>
<span id="cb47-13"><a href="stis.html#cb47-13" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">14</span> <span class="sc">~</span> <span class="st">&quot;10 to 14 years&quot;</span>,</span>
<span id="cb47-14"><a href="stis.html#cb47-14" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">15</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">19</span> <span class="sc">~</span> <span class="st">&quot;15 to 19 years&quot;</span>,</span>
<span id="cb47-15"><a href="stis.html#cb47-15" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">20</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">24</span> <span class="sc">~</span> <span class="st">&quot;20 to 24 years&quot;</span>,</span>
<span id="cb47-16"><a href="stis.html#cb47-16" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">34</span> <span class="sc">~</span> <span class="st">&quot;25 to 34 years&quot;</span>,</span>
<span id="cb47-17"><a href="stis.html#cb47-17" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">44</span> <span class="sc">~</span> <span class="st">&quot;35 to 44 years&quot;</span>,</span>
<span id="cb47-18"><a href="stis.html#cb47-18" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">45</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">54</span> <span class="sc">~</span> <span class="st">&quot;45 to 54 years&quot;</span>,</span>
<span id="cb47-19"><a href="stis.html#cb47-19" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">55</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">59</span> <span class="sc">~</span> <span class="st">&quot;55 to 59 years&quot;</span>,</span>
<span id="cb47-20"><a href="stis.html#cb47-20" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">64</span> <span class="sc">~</span> <span class="st">&quot;60 to 64 years&quot;</span>,</span>
<span id="cb47-21"><a href="stis.html#cb47-21" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">65</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">74</span> <span class="sc">~</span> <span class="st">&quot;65 to 74 years&quot;</span>,</span>
<span id="cb47-22"><a href="stis.html#cb47-22" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">75</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">84</span> <span class="sc">~</span> <span class="st">&quot;75 to 84 years&quot;</span>,</span>
<span id="cb47-23"><a href="stis.html#cb47-23" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">85</span> <span class="sc">~</span> <span class="st">&quot;85 years and over&quot;</span></span>
<span id="cb47-24"><a href="stis.html#cb47-24" tabindex="-1"></a>      ),</span>
<span id="cb47-25"><a href="stis.html#cb47-25" tabindex="-1"></a>      <span class="co"># Set the factor&#39;s levels (to order them)</span></span>
<span id="cb47-26"><a href="stis.html#cb47-26" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Under 5 years&quot;</span>, <span class="st">&quot;5 to 9 years&quot;</span>, <span class="st">&quot;10 to 14 years&quot;</span>,</span>
<span id="cb47-27"><a href="stis.html#cb47-27" tabindex="-1"></a>                 <span class="st">&quot;15 to 19 years&quot;</span>, <span class="st">&quot;20 to 24 years&quot;</span>, <span class="st">&quot;25 to 34 years&quot;</span>,</span>
<span id="cb47-28"><a href="stis.html#cb47-28" tabindex="-1"></a>                 <span class="st">&quot;35 to 44 years&quot;</span>, <span class="st">&quot;45 to 54 years&quot;</span>, <span class="st">&quot;55 to 59 years&quot;</span>,</span>
<span id="cb47-29"><a href="stis.html#cb47-29" tabindex="-1"></a>                 <span class="st">&quot;60 to 64 years&quot;</span>, <span class="st">&quot;65 to 74 years&quot;</span>, <span class="st">&quot;75 to 84 years&quot;</span>)</span>
<span id="cb47-30"><a href="stis.html#cb47-30" tabindex="-1"></a>    ),</span>
<span id="cb47-31"><a href="stis.html#cb47-31" tabindex="-1"></a>    </span>
<span id="cb47-32"><a href="stis.html#cb47-32" tabindex="-1"></a>    <span class="co"># Variable for six age groups (more standard)</span></span>
<span id="cb47-33"><a href="stis.html#cb47-33" tabindex="-1"></a>    <span class="at">age_6 =</span> <span class="fu">case_when</span>(</span>
<span id="cb47-34"><a href="stis.html#cb47-34" tabindex="-1"></a>        Age <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">&quot;Under 5 years&quot;</span>,</span>
<span id="cb47-35"><a href="stis.html#cb47-35" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;</span> <span class="dv">18</span> <span class="sc">~</span> <span class="st">&quot;5 to 17 years&quot;</span>,</span>
<span id="cb47-36"><a href="stis.html#cb47-36" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;</span> <span class="dv">25</span> <span class="sc">~</span> <span class="st">&quot;18 to 24 years&quot;</span>,</span>
<span id="cb47-37"><a href="stis.html#cb47-37" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;</span> <span class="dv">45</span> <span class="sc">~</span> <span class="st">&quot;25 to 44 years&quot;</span>,</span>
<span id="cb47-38"><a href="stis.html#cb47-38" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">45</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;</span> <span class="dv">65</span> <span class="sc">~</span> <span class="st">&quot;45 to 64 years&quot;</span>,</span>
<span id="cb47-39"><a href="stis.html#cb47-39" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">65</span> <span class="sc">~</span> <span class="st">&quot;65 years and over&quot;</span></span>
<span id="cb47-40"><a href="stis.html#cb47-40" tabindex="-1"></a>    ),</span>
<span id="cb47-41"><a href="stis.html#cb47-41" tabindex="-1"></a>    </span>
<span id="cb47-42"><a href="stis.html#cb47-42" tabindex="-1"></a>    <span class="co"># Variable for the year when the case occurred</span></span>
<span id="cb47-43"><a href="stis.html#cb47-43" tabindex="-1"></a>    <span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">MMWR Date</span><span class="st">`</span>)</span>
<span id="cb47-44"><a href="stis.html#cb47-44" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb47-45"><a href="stis.html#cb47-45" tabindex="-1"></a>  </span>
<span id="cb47-46"><a href="stis.html#cb47-46" tabindex="-1"></a>  <span class="co"># Group by case year and age group</span></span>
<span id="cb47-47"><a href="stis.html#cb47-47" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, age_6) <span class="sc">%&gt;%</span> </span>
<span id="cb47-48"><a href="stis.html#cb47-48" tabindex="-1"></a>  </span>
<span id="cb47-49"><a href="stis.html#cb47-49" tabindex="-1"></a>  <span class="co"># Tally (count) the cases in each group</span></span>
<span id="cb47-50"><a href="stis.html#cb47-50" tabindex="-1"></a>  <span class="fu">tally</span>(<span class="at">name =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb47-51"><a href="stis.html#cb47-51" tabindex="-1"></a>  </span>
<span id="cb47-52"><a href="stis.html#cb47-52" tabindex="-1"></a>  <span class="co"># Fill in any year/age combos with no cases</span></span>
<span id="cb47-53"><a href="stis.html#cb47-53" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">fill =</span> <span class="fu">list</span>(<span class="at">Count =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-54"><a href="stis.html#cb47-54" tabindex="-1"></a>  </span>
<span id="cb47-55"><a href="stis.html#cb47-55" tabindex="-1"></a>  <span class="co"># Filter out groups with no age</span></span>
<span id="cb47-56"><a href="stis.html#cb47-56" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(age_6)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-57"><a href="stis.html#cb47-57" tabindex="-1"></a>  </span>
<span id="cb47-58"><a href="stis.html#cb47-58" tabindex="-1"></a>  <span class="co"># Join (merge) the tallied data with the population totals</span></span>
<span id="cb47-59"><a href="stis.html#cb47-59" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb47-60"><a href="stis.html#cb47-60" tabindex="-1"></a>    census_age,</span>
<span id="cb47-61"><a href="stis.html#cb47-61" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">join_by</span>(age_6 <span class="sc">==</span> Label, Year)</span>
<span id="cb47-62"><a href="stis.html#cb47-62" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb47-63"><a href="stis.html#cb47-63" tabindex="-1"></a>  </span>
<span id="cb47-64"><a href="stis.html#cb47-64" tabindex="-1"></a>  <span class="co"># Calculate the incidence for each year/age group</span></span>
<span id="cb47-65"><a href="stis.html#cb47-65" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&quot;Incidence&quot;</span> <span class="ot">=</span> Count <span class="sc">/</span> Population <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb47-66"><a href="stis.html#cb47-66" tabindex="-1"></a>         </span>
<span id="cb47-67"><a href="stis.html#cb47-67" tabindex="-1"></a>         <span class="co"># Change the age group variable to a factor (for ordering)</span></span>
<span id="cb47-68"><a href="stis.html#cb47-68" tabindex="-1"></a>         <span class="st">&quot;age_6&quot;</span> <span class="ot">=</span> <span class="fu">factor</span>(</span>
<span id="cb47-69"><a href="stis.html#cb47-69" tabindex="-1"></a>           <span class="at">x =</span> age_6,</span>
<span id="cb47-70"><a href="stis.html#cb47-70" tabindex="-1"></a>           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Under 5 years&quot;</span>, <span class="st">&quot;5 to 17 years&quot;</span>,</span>
<span id="cb47-71"><a href="stis.html#cb47-71" tabindex="-1"></a>                      <span class="st">&quot;18 to 24 years&quot;</span>, <span class="st">&quot;25 to 44 years&quot;</span>,</span>
<span id="cb47-72"><a href="stis.html#cb47-72" tabindex="-1"></a>                      <span class="st">&quot;45 to 64 years&quot;</span>, <span class="st">&quot;65 years and over&quot;</span>)</span>
<span id="cb47-73"><a href="stis.html#cb47-73" tabindex="-1"></a>         ))</span></code></pre></div>
<p>See the code comments for complete details, but to summarize, this block does the following:</p>
<ol style="list-style-type: decimal">
<li><em>Mutate</em> (create) age grouping variables and a year variable based on existing variables.</li>
<li><em>Group</em> by year and age group.</li>
<li><em>Tally</em> (count) the cases in each group.</li>
<li>Fill in any missing groups with zeroes and filter out undefined age groups.</li>
<li><em>Join</em> (merge) the tallied data and the population data</li>
<li>Calculate incidence and order the age grouping variable</li>
</ol>
<p><code>case_when()</code> is a very useful function from the tidyverse that makes if/else statements more compact. Each line in this example is an if/then statement, and each comma means “else”. The function also includes an option, <code>.default</code>, that is the final “else” with no “if”. For more information, see the <a href="https://dplyr.tidyverse.org/reference/case_when.html">dplyr help page</a> or type <code>?case_when</code> with <code>tidyverse</code> loaded.</p>
</div>
<div id="chlamydia-incidence-by-race" class="section level3 hasAnchor" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> Chlamydia incidence by race<a href="stis.html#chlamydia-incidence-by-race" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Next, we’ll do it by race.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="stis.html#cb48-1" tabindex="-1"></a>chla_race <span class="ot">&lt;-</span> chla_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="stis.html#cb48-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb48-3"><a href="stis.html#cb48-3" tabindex="-1"></a>    <span class="st">&quot;race_5&quot;</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb48-4"><a href="stis.html#cb48-4" tabindex="-1"></a>        Race <span class="sc">==</span> <span class="st">&quot;White&quot;</span> <span class="sc">~</span> <span class="st">&quot;White&quot;</span>,</span>
<span id="cb48-5"><a href="stis.html#cb48-5" tabindex="-1"></a>        Race <span class="sc">==</span> <span class="st">&quot;Black or African American&quot;</span> </span>
<span id="cb48-6"><a href="stis.html#cb48-6" tabindex="-1"></a>          <span class="sc">~</span> <span class="st">&quot;Black or African American&quot;</span>,</span>
<span id="cb48-7"><a href="stis.html#cb48-7" tabindex="-1"></a>        Race <span class="sc">==</span> <span class="st">&quot;Asian&quot;</span> <span class="sc">~</span> <span class="st">&quot;Asian&quot;</span>,</span>
<span id="cb48-8"><a href="stis.html#cb48-8" tabindex="-1"></a>        <span class="fu">str_detect</span>(Race, <span class="st">&quot;,&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Two or more races&quot;</span>,</span>
<span id="cb48-9"><a href="stis.html#cb48-9" tabindex="-1"></a>        Race <span class="sc">==</span> <span class="st">&quot;Unknown&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(Race) <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb48-10"><a href="stis.html#cb48-10" tabindex="-1"></a>        <span class="at">.default =</span> <span class="st">&quot;Some other race&quot;</span></span>
<span id="cb48-11"><a href="stis.html#cb48-11" tabindex="-1"></a>    ),</span>
<span id="cb48-12"><a href="stis.html#cb48-12" tabindex="-1"></a>    <span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">MMWR Date</span><span class="st">`</span>)</span>
<span id="cb48-13"><a href="stis.html#cb48-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb48-14"><a href="stis.html#cb48-14" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, race_5) <span class="sc">%&gt;%</span> </span>
<span id="cb48-15"><a href="stis.html#cb48-15" tabindex="-1"></a>  <span class="fu">tally</span>(<span class="at">name =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-16"><a href="stis.html#cb48-16" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">fill =</span> <span class="fu">list</span>(<span class="at">Count =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-17"><a href="stis.html#cb48-17" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(race_5)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-18"><a href="stis.html#cb48-18" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb48-19"><a href="stis.html#cb48-19" tabindex="-1"></a>    census_raceth,</span>
<span id="cb48-20"><a href="stis.html#cb48-20" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">join_by</span>(race_5 <span class="sc">==</span> Label, Year)</span>
<span id="cb48-21"><a href="stis.html#cb48-21" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb48-22"><a href="stis.html#cb48-22" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&quot;Incidence&quot;</span> <span class="ot">=</span> Count <span class="sc">/</span> Population <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb48-23"><a href="stis.html#cb48-23" tabindex="-1"></a>         <span class="st">&quot;race_5&quot;</span> <span class="ot">=</span> <span class="fu">factor</span>(</span>
<span id="cb48-24"><a href="stis.html#cb48-24" tabindex="-1"></a>           <span class="at">x =</span> race_5,</span>
<span id="cb48-25"><a href="stis.html#cb48-25" tabindex="-1"></a>           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Asian&quot;</span>, <span class="st">&quot;Black or African American&quot;</span>, <span class="st">&quot;White&quot;</span>,</span>
<span id="cb48-26"><a href="stis.html#cb48-26" tabindex="-1"></a>                      <span class="st">&quot;Some other race&quot;</span>, <span class="st">&quot;Two or more races&quot;</span>)</span>
<span id="cb48-27"><a href="stis.html#cb48-27" tabindex="-1"></a>         ))</span></code></pre></div>
<p>This code block is similar, so code comments are not included.</p>
</div>
<div id="chlamydia-count-by-municipality" class="section level3 hasAnchor" number="3.5.3">
<h3><span class="header-section-number">3.5.3</span> Chlamydia count by municipality<a href="stis.html#chlamydia-count-by-municipality" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Last, we’ll calculate counts by municipality in Wake County. Incidence is not calculated here because of the difficulty of determining whether a case lives within city limits.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="stis.html#cb49-1" tabindex="-1"></a><span class="co"># Start with the filtered data</span></span>
<span id="cb49-2"><a href="stis.html#cb49-2" tabindex="-1"></a>chla_city <span class="ot">&lt;-</span> chla_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="stis.html#cb49-3" tabindex="-1"></a>  </span>
<span id="cb49-4"><a href="stis.html#cb49-4" tabindex="-1"></a>  <span class="co"># Create a variable for the year when the case occurred</span></span>
<span id="cb49-5"><a href="stis.html#cb49-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">MMWR Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-6"><a href="stis.html#cb49-6" tabindex="-1"></a>  </span>
<span id="cb49-7"><a href="stis.html#cb49-7" tabindex="-1"></a>  <span class="co"># Group by year and city (determined algorithmically)</span></span>
<span id="cb49-8"><a href="stis.html#cb49-8" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, City_guess) <span class="sc">%&gt;%</span> </span>
<span id="cb49-9"><a href="stis.html#cb49-9" tabindex="-1"></a>  </span>
<span id="cb49-10"><a href="stis.html#cb49-10" tabindex="-1"></a>  <span class="co"># Tally (count) the cases in each group</span></span>
<span id="cb49-11"><a href="stis.html#cb49-11" tabindex="-1"></a>  <span class="fu">tally</span>(<span class="at">name =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-12"><a href="stis.html#cb49-12" tabindex="-1"></a>  </span>
<span id="cb49-13"><a href="stis.html#cb49-13" tabindex="-1"></a>  <span class="co"># Fill in any year/age combos with no cases</span></span>
<span id="cb49-14"><a href="stis.html#cb49-14" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">fill =</span> <span class="fu">list</span>(<span class="at">Count =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-15"><a href="stis.html#cb49-15" tabindex="-1"></a>  </span>
<span id="cb49-16"><a href="stis.html#cb49-16" tabindex="-1"></a>  <span class="co"># Filter out groups with no city</span></span>
<span id="cb49-17"><a href="stis.html#cb49-17" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(City_guess)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-18"><a href="stis.html#cb49-18" tabindex="-1"></a>  </span>
<span id="cb49-19"><a href="stis.html#cb49-19" tabindex="-1"></a>  <span class="co"># Suppress year/city values with 5 or fewer cases</span></span>
<span id="cb49-20"><a href="stis.html#cb49-20" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb49-21"><a href="stis.html#cb49-21" tabindex="-1"></a>    <span class="st">&quot;Count&quot;</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb49-22"><a href="stis.html#cb49-22" tabindex="-1"></a>      Count <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb49-23"><a href="stis.html#cb49-23" tabindex="-1"></a>      <span class="at">.default =</span> Count</span>
<span id="cb49-24"><a href="stis.html#cb49-24" tabindex="-1"></a>    )</span>
<span id="cb49-25"><a href="stis.html#cb49-25" tabindex="-1"></a>  )</span></code></pre></div>
<p>See the code comments for details. Some notable changes from the prior versions:</p>
<ol style="list-style-type: decimal">
<li>Municipalities do not need to be combined into groups, so there is no mutate for that.</li>
<li>Because some municipalities (or the portion of them inside Wake) are small, counts of 5 or fewer are suppressed to protect anonymity.</li>
</ol>
</div>
</div>
<div id="graphing-chlamydia" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> Graphing chlamydia<a href="stis.html#graphing-chlamydia" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Finally, we create the graphics. These are best represented as bar graphs, though line graphs with multiple lines may also be appropriate.</p>
<div id="chlamydia-incidence-by-age-group-1" class="section level3 hasAnchor" number="3.6.1">
<h3><span class="header-section-number">3.6.1</span> Chlamydia incidence by age group<a href="stis.html#chlamydia-incidence-by-age-group-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Since the data is already prepared for us, we just need to code the graph. We do this using <code>ggplot2</code>, part of the <code>tidyverse</code> package.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="stis.html#cb50-1" tabindex="-1"></a><span class="co"># Set up the plot, specifying dataset and variables</span></span>
<span id="cb50-2"><a href="stis.html#cb50-2" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb50-3"><a href="stis.html#cb50-3" tabindex="-1"></a>  chla_age,</span>
<span id="cb50-4"><a href="stis.html#cb50-4" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> age_6, <span class="at">y =</span> Incidence, <span class="at">fill =</span> <span class="fu">as.character</span>(Year))</span>
<span id="cb50-5"><a href="stis.html#cb50-5" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb50-6"><a href="stis.html#cb50-6" tabindex="-1"></a>  </span>
<span id="cb50-7"><a href="stis.html#cb50-7" tabindex="-1"></a>  <span class="co"># Use a bar (column) graph with multiple bars for each age group</span></span>
<span id="cb50-8"><a href="stis.html#cb50-8" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb50-9"><a href="stis.html#cb50-9" tabindex="-1"></a>  </span>
<span id="cb50-10"><a href="stis.html#cb50-10" tabindex="-1"></a>  <span class="co"># Set the color scheme (using RColorBrewer)</span></span>
<span id="cb50-11"><a href="stis.html#cb50-11" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set2&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-12"><a href="stis.html#cb50-12" tabindex="-1"></a>  </span>
<span id="cb50-13"><a href="stis.html#cb50-13" tabindex="-1"></a>  <span class="co"># Set the axis and legend labels</span></span>
<span id="cb50-14"><a href="stis.html#cb50-14" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb50-15"><a href="stis.html#cb50-15" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age group&quot;</span>,</span>
<span id="cb50-16"><a href="stis.html#cb50-16" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Cases per 100k population&quot;</span>,</span>
<span id="cb50-17"><a href="stis.html#cb50-17" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Year&quot;</span></span>
<span id="cb50-18"><a href="stis.html#cb50-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb50-19"><a href="stis.html#cb50-19" tabindex="-1"></a>  </span>
<span id="cb50-20"><a href="stis.html#cb50-20" tabindex="-1"></a>  <span class="co"># Set the ggplot theme</span></span>
<span id="cb50-21"><a href="stis.html#cb50-21" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb50-22"><a href="stis.html#cb50-22" tabindex="-1"></a>  </span>
<span id="cb50-23"><a href="stis.html#cb50-23" tabindex="-1"></a>  <span class="co"># Set the plot title</span></span>
<span id="cb50-24"><a href="stis.html#cb50-24" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Chlamydia Incidence by Age Group in Wake County, 2019-2023&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-25"><a href="stis.html#cb50-25" tabindex="-1"></a>  </span>
<span id="cb50-26"><a href="stis.html#cb50-26" tabindex="-1"></a>  <span class="co"># Center the plot title and put the legend on the bottom</span></span>
<span id="cb50-27"><a href="stis.html#cb50-27" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb50-28"><a href="stis.html#cb50-28" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb50-29"><a href="stis.html#cb50-29" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb50-30"><a href="stis.html#cb50-30" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/chla%20age-1.png" width="672" /></p>
<p>This bar graph shows the incidence (sometimes called rate) of chlamydia in each age group over the prior five years. If you’d like, you can open this RMarkdown file (03-STI.Rmd) on the SharePoint and play with the graph code to edit the settings.</p>
</div>
<div id="chlamydia-incidence-by-race-1" class="section level3 hasAnchor" number="3.6.2">
<h3><span class="header-section-number">3.6.2</span> Chlamydia incidence by race<a href="stis.html#chlamydia-incidence-by-race-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now we graph by race:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="stis.html#cb51-1" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb51-2"><a href="stis.html#cb51-2" tabindex="-1"></a>  chla_race,</span>
<span id="cb51-3"><a href="stis.html#cb51-3" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> race_5, <span class="at">y =</span> Incidence, <span class="at">fill =</span> <span class="fu">as.character</span>(Year))</span>
<span id="cb51-4"><a href="stis.html#cb51-4" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb51-5"><a href="stis.html#cb51-5" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb51-6"><a href="stis.html#cb51-6" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set2&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-7"><a href="stis.html#cb51-7" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb51-8"><a href="stis.html#cb51-8" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Race&quot;</span>,</span>
<span id="cb51-9"><a href="stis.html#cb51-9" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Cases per 100k population&quot;</span>,</span>
<span id="cb51-10"><a href="stis.html#cb51-10" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Year&quot;</span></span>
<span id="cb51-11"><a href="stis.html#cb51-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb51-12"><a href="stis.html#cb51-12" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb51-13"><a href="stis.html#cb51-13" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Chlamydia Incidence by Race in Wake County, 2019-2023&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-14"><a href="stis.html#cb51-14" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb51-15"><a href="stis.html#cb51-15" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb51-16"><a href="stis.html#cb51-16" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb51-17"><a href="stis.html#cb51-17" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/chla%20race-1.png" width="672" /></p>
<p>This is practically the same as the age graph, so the code should be familiar.</p>
</div>
<div id="chlamydia-count-by-municipality-1" class="section level3 hasAnchor" number="3.6.3">
<h3><span class="header-section-number">3.6.3</span> Chlamydia count by municipality<a href="stis.html#chlamydia-count-by-municipality-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Finally, we’ll make a counts graph for municipalities. This would look <em>really</em> ugly if it were the same orientation, so let’s graph it sideways!</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="stis.html#cb52-1" tabindex="-1"></a><span class="co"># Set up the graph</span></span>
<span id="cb52-2"><a href="stis.html#cb52-2" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb52-3"><a href="stis.html#cb52-3" tabindex="-1"></a>  <span class="co"># Specify the dataset</span></span>
<span id="cb52-4"><a href="stis.html#cb52-4" tabindex="-1"></a>  chla_city,</span>
<span id="cb52-5"><a href="stis.html#cb52-5" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb52-6"><a href="stis.html#cb52-6" tabindex="-1"></a>    <span class="at">x =</span> Count,                      <span class="co"># Count on the x-axis</span></span>
<span id="cb52-7"><a href="stis.html#cb52-7" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">fct_rev</span>(City_guess),        <span class="co"># Reversed city on y (to alphabetize)</span></span>
<span id="cb52-8"><a href="stis.html#cb52-8" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">fct_rev</span>(<span class="fu">as.factor</span>(Year)) <span class="co"># Reversed year (to order top to bottom)</span></span>
<span id="cb52-9"><a href="stis.html#cb52-9" tabindex="-1"></a>  )</span>
<span id="cb52-10"><a href="stis.html#cb52-10" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb52-11"><a href="stis.html#cb52-11" tabindex="-1"></a>  </span>
<span id="cb52-12"><a href="stis.html#cb52-12" tabindex="-1"></a>  <span class="co"># Use a bar (column) graph with multiple bars for each age group</span></span>
<span id="cb52-13"><a href="stis.html#cb52-13" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb52-14"><a href="stis.html#cb52-14" tabindex="-1"></a>  </span>
<span id="cb52-15"><a href="stis.html#cb52-15" tabindex="-1"></a>  <span class="co"># Set the axis and legend labels</span></span>
<span id="cb52-16"><a href="stis.html#cb52-16" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb52-17"><a href="stis.html#cb52-17" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Cases&quot;</span>,</span>
<span id="cb52-18"><a href="stis.html#cb52-18" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Municipality&quot;</span>,</span>
<span id="cb52-19"><a href="stis.html#cb52-19" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Year&quot;</span></span>
<span id="cb52-20"><a href="stis.html#cb52-20" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb52-21"><a href="stis.html#cb52-21" tabindex="-1"></a>  </span>
<span id="cb52-22"><a href="stis.html#cb52-22" tabindex="-1"></a>  <span class="co"># Set the color scheme (using RColorBrewer) and flip the legend</span></span>
<span id="cb52-23"><a href="stis.html#cb52-23" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set2&quot;</span>,</span>
<span id="cb52-24"><a href="stis.html#cb52-24" tabindex="-1"></a>                    <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb52-25"><a href="stis.html#cb52-25" tabindex="-1"></a>  </span>
<span id="cb52-26"><a href="stis.html#cb52-26" tabindex="-1"></a>  <span class="co"># Set the ggplot theme</span></span>
<span id="cb52-27"><a href="stis.html#cb52-27" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb52-28"><a href="stis.html#cb52-28" tabindex="-1"></a>  </span>
<span id="cb52-29"><a href="stis.html#cb52-29" tabindex="-1"></a>  <span class="co"># Set the plot title</span></span>
<span id="cb52-30"><a href="stis.html#cb52-30" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Chlamydia Count by Municipality in Wake County, 2019-2023&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-31"><a href="stis.html#cb52-31" tabindex="-1"></a>  </span>
<span id="cb52-32"><a href="stis.html#cb52-32" tabindex="-1"></a>  <span class="co"># Center the plot title and put the legend on the bottom</span></span>
<span id="cb52-33"><a href="stis.html#cb52-33" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb52-34"><a href="stis.html#cb52-34" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb52-35"><a href="stis.html#cb52-35" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb52-36"><a href="stis.html#cb52-36" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/chla%20city-1.png" width="672" /></p>
<p>This graph shows the counts of chlamydia each year for each Wake County municipality. Of course, because of population, Raleigh overtakes the graph. We can also filter Raleigh out using this code:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="stis.html#cb53-1" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb53-2"><a href="stis.html#cb53-2" tabindex="-1"></a>  chla_city <span class="sc">%&gt;%</span> </span>
<span id="cb53-3"><a href="stis.html#cb53-3" tabindex="-1"></a>    <span class="fu">filter</span>(City_guess <span class="sc">!=</span> <span class="st">&quot;RALEIGH&quot;</span>), <span class="co"># Pipe the data into a filter</span></span>
<span id="cb53-4"><a href="stis.html#cb53-4" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb53-5"><a href="stis.html#cb53-5" tabindex="-1"></a>    <span class="at">x =</span> Count,</span>
<span id="cb53-6"><a href="stis.html#cb53-6" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">fct_rev</span>(City_guess),</span>
<span id="cb53-7"><a href="stis.html#cb53-7" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">fct_rev</span>(<span class="fu">as.factor</span>(Year))</span>
<span id="cb53-8"><a href="stis.html#cb53-8" tabindex="-1"></a>  )</span>
<span id="cb53-9"><a href="stis.html#cb53-9" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb53-10"><a href="stis.html#cb53-10" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb53-11"><a href="stis.html#cb53-11" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb53-12"><a href="stis.html#cb53-12" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Cases&quot;</span>,</span>
<span id="cb53-13"><a href="stis.html#cb53-13" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Municipality&quot;</span>,</span>
<span id="cb53-14"><a href="stis.html#cb53-14" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Year&quot;</span></span>
<span id="cb53-15"><a href="stis.html#cb53-15" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-16"><a href="stis.html#cb53-16" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set2&quot;</span>, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb53-17"><a href="stis.html#cb53-17" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb53-18"><a href="stis.html#cb53-18" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Chlamydia Count by Municipality in Wake County, 2019-2023&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-19"><a href="stis.html#cb53-19" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb53-20"><a href="stis.html#cb53-20" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb53-21"><a href="stis.html#cb53-21" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb53-22"><a href="stis.html#cb53-22" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/chla%20city%202-1.png" width="672" /></p>
<p>Now, we can see a bit more detail for the other municipalities’ counts.</p>
</div>
</div>
<div id="tallying-and-graphing-gonorrhea" class="section level2 hasAnchor" number="3.7">
<h2><span class="header-section-number">3.7</span> Tallying and graphing gonorrhea<a href="stis.html#tallying-and-graphing-gonorrhea" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Of course, there are two diseases we’d like to analyze here. Next, we’ll analyze gonorrhea. Since this code is practically the same as for chlamydia, I’ll avoid explanations and just include the code.</p>
<div id="importing" class="section level3 hasAnchor" number="3.7.1">
<h3><span class="header-section-number">3.7.1</span> Importing<a href="stis.html#importing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="stis.html#cb54-1" tabindex="-1"></a><span class="co"># Import data</span></span>
<span id="cb54-2"><a href="stis.html#cb54-2" tabindex="-1"></a>tables <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;gono19&quot;</span>, <span class="st">&quot;gono20&quot;</span>, <span class="st">&quot;gono21&quot;</span>, <span class="st">&quot;gono22&quot;</span>, <span class="st">&quot;gono23&quot;</span>)</span>
<span id="cb54-3"><a href="stis.html#cb54-3" tabindex="-1"></a></span>
<span id="cb54-4"><a href="stis.html#cb54-4" tabindex="-1"></a>sesh_read <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb54-5"><a href="stis.html#cb54-5" tabindex="-1"></a>  <span class="fu">read_csv</span>(</span>
<span id="cb54-6"><a href="stis.html#cb54-6" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">&quot;../Data/&quot;</span>, x, <span class="st">&quot;.csv&quot;</span>),</span>
<span id="cb54-7"><a href="stis.html#cb54-7" tabindex="-1"></a>    <span class="at">show_col_types =</span> <span class="cn">FALSE</span>,</span>
<span id="cb54-8"><a href="stis.html#cb54-8" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="st">&quot;ncccccccncccccccccncccccccccccccccccncc&quot;</span></span>
<span id="cb54-9"><a href="stis.html#cb54-9" tabindex="-1"></a>  )</span>
<span id="cb54-10"><a href="stis.html#cb54-10" tabindex="-1"></a>}</span>
<span id="cb54-11"><a href="stis.html#cb54-11" tabindex="-1"></a></span>
<span id="cb54-12"><a href="stis.html#cb54-12" tabindex="-1"></a>gono <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb54-13"><a href="stis.html#cb54-13" tabindex="-1"></a>  tables, sesh_read</span>
<span id="cb54-14"><a href="stis.html#cb54-14" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb54-15"><a href="stis.html#cb54-15" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb54-16"><a href="stis.html#cb54-16" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-17"><a href="stis.html#cb54-17" tabindex="-1"></a>    <span class="st">&quot;Create Date&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Create Date</span><span class="st">`</span>),</span>
<span id="cb54-18"><a href="stis.html#cb54-18" tabindex="-1"></a>    <span class="st">&quot;Birthdate&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Birthdate</span><span class="st">`</span>),</span>
<span id="cb54-19"><a href="stis.html#cb54-19" tabindex="-1"></a>    <span class="st">&quot;City&quot;</span> <span class="ot">=</span> <span class="fu">toupper</span>(City),</span>
<span id="cb54-20"><a href="stis.html#cb54-20" tabindex="-1"></a>    <span class="st">&quot;Symptom Onset Date&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Symptom Onset Date</span><span class="st">`</span>),</span>
<span id="cb54-21"><a href="stis.html#cb54-21" tabindex="-1"></a>    <span class="st">&quot;Reporting Date to CDC&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Reporting Date to CDC</span><span class="st">`</span>),</span>
<span id="cb54-22"><a href="stis.html#cb54-22" tabindex="-1"></a>    <span class="st">&quot;Diagnosis Date&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Diagnosis Date</span><span class="st">`</span>),</span>
<span id="cb54-23"><a href="stis.html#cb54-23" tabindex="-1"></a>    <span class="st">&quot;Date Initial Report to PH&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Date Initial Report to PH</span><span class="st">`</span>),</span>
<span id="cb54-24"><a href="stis.html#cb54-24" tabindex="-1"></a>    <span class="st">&quot;Date Identified as Contact&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Date Identified as Contact</span><span class="st">`</span>),</span>
<span id="cb54-25"><a href="stis.html#cb54-25" tabindex="-1"></a>    <span class="st">&quot;Specimen Date&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">Specimen Date</span><span class="st">`</span>),</span>
<span id="cb54-26"><a href="stis.html#cb54-26" tabindex="-1"></a>    <span class="st">&quot;MMWR Date&quot;</span> <span class="ot">=</span> <span class="fu">mdy</span>(<span class="st">`</span><span class="at">MMWR Date</span><span class="st">`</span>),</span>
<span id="cb54-27"><a href="stis.html#cb54-27" tabindex="-1"></a>    <span class="st">&quot;Zip&quot;</span> <span class="ot">=</span> <span class="fu">str_sub</span>(Zip, <span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb54-28"><a href="stis.html#cb54-28" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb54-29"><a href="stis.html#cb54-29" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ZIP =</span> Zip)</span></code></pre></div>
</div>
<div id="filtering" class="section level3 hasAnchor" number="3.7.2">
<h3><span class="header-section-number">3.7.2</span> Filtering<a href="stis.html#filtering" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="stis.html#cb55-1" tabindex="-1"></a><span class="co"># Filter out non-Wake cases</span></span>
<span id="cb55-2"><a href="stis.html#cb55-2" tabindex="-1"></a>zips <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;wake_zips.csv&quot;</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>, <span class="at">col_types =</span> <span class="st">&quot;c&quot;</span>)</span>
<span id="cb55-3"><a href="stis.html#cb55-3" tabindex="-1"></a></span>
<span id="cb55-4"><a href="stis.html#cb55-4" tabindex="-1"></a>cities <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Apex&quot;</span>, <span class="st">&quot;Cary&quot;</span>, <span class="st">&quot;Fuquay-Varina&quot;</span>, <span class="st">&quot;Fuquay&quot;</span>, <span class="st">&quot;Garner&quot;</span>, <span class="st">&quot;Holly Springs&quot;</span>, <span class="st">&quot;Knightdale&quot;</span>, <span class="st">&quot;Morrisville&quot;</span>,</span>
<span id="cb55-5"><a href="stis.html#cb55-5" tabindex="-1"></a>            <span class="st">&quot;Raleigh&quot;</span>, <span class="st">&quot;Rolesville&quot;</span>, <span class="st">&quot;Wake Forest&quot;</span>, <span class="st">&quot;Wendell&quot;</span>, <span class="st">&quot;Zebulon&quot;</span>, <span class="st">&quot;Durham&quot;</span>, <span class="st">&quot;Angier&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-6"><a href="stis.html#cb55-6" tabindex="-1"></a>  <span class="fu">toupper</span>()</span>
<span id="cb55-7"><a href="stis.html#cb55-7" tabindex="-1"></a></span>
<span id="cb55-8"><a href="stis.html#cb55-8" tabindex="-1"></a>gono_filtered <span class="ot">&lt;-</span> gono <span class="sc">%&gt;%</span> </span>
<span id="cb55-9"><a href="stis.html#cb55-9" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb55-10"><a href="stis.html#cb55-10" tabindex="-1"></a>    <span class="st">&quot;del&quot;</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb55-11"><a href="stis.html#cb55-11" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(County) <span class="sc">&amp;</span> County <span class="sc">!=</span> <span class="st">&quot;Wake County&quot;</span> <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-12"><a href="stis.html#cb55-12" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(ZIP) <span class="sc">&amp;</span> <span class="sc">!</span>(ZIP <span class="sc">%in%</span> zips<span class="sc">$</span>ZIP) <span class="sc">&amp;</span> <span class="fu">is.na</span>(County) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-13"><a href="stis.html#cb55-13" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(City) <span class="sc">&amp;</span> <span class="sc">!</span>(</span>
<span id="cb55-14"><a href="stis.html#cb55-14" tabindex="-1"></a>        <span class="fu">stringdistmatrix</span>(gono<span class="sc">$</span>City, cities, <span class="at">method =</span> <span class="st">&quot;lv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-15"><a href="stis.html#cb55-15" tabindex="-1"></a>          <span class="fu">apply</span>(<span class="dv">1</span>, <span class="cf">function</span>(row){<span class="fu">any</span>(row <span class="sc">&lt;=</span> <span class="dv">5</span>)})</span>
<span id="cb55-16"><a href="stis.html#cb55-16" tabindex="-1"></a>      ) <span class="sc">&amp;</span> <span class="fu">is.na</span>(County) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-17"><a href="stis.html#cb55-17" tabindex="-1"></a>      <span class="fu">is.na</span>(County) <span class="sc">&amp;</span> <span class="fu">is.na</span>(ZIP) <span class="sc">&amp;</span> <span class="fu">is.na</span>(City) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-18"><a href="stis.html#cb55-18" tabindex="-1"></a>      <span class="at">.default =</span> <span class="cn">FALSE</span></span>
<span id="cb55-19"><a href="stis.html#cb55-19" tabindex="-1"></a>    ),</span>
<span id="cb55-20"><a href="stis.html#cb55-20" tabindex="-1"></a>    <span class="st">&quot;City_guess&quot;</span> <span class="ot">=</span> <span class="fu">map_chr</span>(City, <span class="cf">function</span>(city){</span>
<span id="cb55-21"><a href="stis.html#cb55-21" tabindex="-1"></a>      <span class="cf">if</span>(city <span class="sc">%in%</span> cities){</span>
<span id="cb55-22"><a href="stis.html#cb55-22" tabindex="-1"></a>        <span class="fu">return</span>(city)</span>
<span id="cb55-23"><a href="stis.html#cb55-23" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">is.na</span>(city)){</span>
<span id="cb55-24"><a href="stis.html#cb55-24" tabindex="-1"></a>        <span class="fu">return</span>(<span class="cn">NA_character_</span>)</span>
<span id="cb55-25"><a href="stis.html#cb55-25" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb55-26"><a href="stis.html#cb55-26" tabindex="-1"></a>      distances <span class="ot">&lt;-</span> <span class="fu">stringdist</span>(city, cities, <span class="at">method =</span> <span class="st">&quot;lv&quot;</span>)</span>
<span id="cb55-27"><a href="stis.html#cb55-27" tabindex="-1"></a>      best_match <span class="ot">&lt;-</span> cities[<span class="fu">which.min</span>(distances)]</span>
<span id="cb55-28"><a href="stis.html#cb55-28" tabindex="-1"></a>      <span class="fu">return</span>(best_match)</span>
<span id="cb55-29"><a href="stis.html#cb55-29" tabindex="-1"></a>      }</span>
<span id="cb55-30"><a href="stis.html#cb55-30" tabindex="-1"></a>    })</span>
<span id="cb55-31"><a href="stis.html#cb55-31" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb55-32"><a href="stis.html#cb55-32" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb55-33"><a href="stis.html#cb55-33" tabindex="-1"></a>    <span class="st">&quot;City_guess&quot;</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb55-34"><a href="stis.html#cb55-34" tabindex="-1"></a>      <span class="fu">is.na</span>(City) <span class="sc">~</span> <span class="st">&quot;OTHER&quot;</span>,</span>
<span id="cb55-35"><a href="stis.html#cb55-35" tabindex="-1"></a>      City_guess <span class="sc">==</span> <span class="st">&quot;FUQUAY&quot;</span> <span class="sc">~</span> <span class="st">&quot;FUQUAY-VARINA&quot;</span>,</span>
<span id="cb55-36"><a href="stis.html#cb55-36" tabindex="-1"></a>      City <span class="sc">==</span> <span class="st">&quot;WAKE&quot;</span> <span class="sc">~</span> <span class="st">&quot;OTHER&quot;</span>,</span>
<span id="cb55-37"><a href="stis.html#cb55-37" tabindex="-1"></a>      City <span class="sc">==</span> <span class="st">&quot;RALEIGHRALEIGH&quot;</span> <span class="sc">~</span> <span class="st">&quot;RALEIGH&quot;</span>,</span>
<span id="cb55-38"><a href="stis.html#cb55-38" tabindex="-1"></a>      <span class="fu">stringdist</span>(City, City_guess, <span class="at">method =</span> <span class="st">&quot;lv&quot;</span>) <span class="sc">&gt;</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">&quot;OTHER&quot;</span>,</span>
<span id="cb55-39"><a href="stis.html#cb55-39" tabindex="-1"></a>      <span class="at">.default =</span> City_guess</span>
<span id="cb55-40"><a href="stis.html#cb55-40" tabindex="-1"></a>    )</span>
<span id="cb55-41"><a href="stis.html#cb55-41" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb55-42"><a href="stis.html#cb55-42" tabindex="-1"></a>  <span class="fu">relocate</span>(City_guess, <span class="at">.after =</span> City) <span class="sc">%&gt;%</span> </span>
<span id="cb55-43"><a href="stis.html#cb55-43" tabindex="-1"></a>  <span class="fu">filter</span>(del <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-44"><a href="stis.html#cb55-44" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>del)</span></code></pre></div>
</div>
<div id="tallying" class="section level3 hasAnchor" number="3.7.3">
<h3><span class="header-section-number">3.7.3</span> Tallying<a href="stis.html#tallying" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="stis.html#cb56-1" tabindex="-1"></a><span class="co"># Tally Wake cases by age, race, and city, then calculate incidence</span></span>
<span id="cb56-2"><a href="stis.html#cb56-2" tabindex="-1"></a>gono_age <span class="ot">&lt;-</span> gono_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb56-3"><a href="stis.html#cb56-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-4"><a href="stis.html#cb56-4" tabindex="-1"></a>    <span class="at">census_age =</span> <span class="fu">factor</span>(</span>
<span id="cb56-5"><a href="stis.html#cb56-5" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">case_when</span>(</span>
<span id="cb56-6"><a href="stis.html#cb56-6" tabindex="-1"></a>        Age <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">&quot;Under 5 years&quot;</span>,</span>
<span id="cb56-7"><a href="stis.html#cb56-7" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">&quot;5 to 9 years&quot;</span>,</span>
<span id="cb56-8"><a href="stis.html#cb56-8" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">14</span> <span class="sc">~</span> <span class="st">&quot;10 to 14 years&quot;</span>,</span>
<span id="cb56-9"><a href="stis.html#cb56-9" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">15</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">19</span> <span class="sc">~</span> <span class="st">&quot;15 to 19 years&quot;</span>,</span>
<span id="cb56-10"><a href="stis.html#cb56-10" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">20</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">24</span> <span class="sc">~</span> <span class="st">&quot;20 to 24 years&quot;</span>,</span>
<span id="cb56-11"><a href="stis.html#cb56-11" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">34</span> <span class="sc">~</span> <span class="st">&quot;25 to 34 years&quot;</span>,</span>
<span id="cb56-12"><a href="stis.html#cb56-12" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">44</span> <span class="sc">~</span> <span class="st">&quot;35 to 44 years&quot;</span>,</span>
<span id="cb56-13"><a href="stis.html#cb56-13" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">45</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">54</span> <span class="sc">~</span> <span class="st">&quot;45 to 54 years&quot;</span>,</span>
<span id="cb56-14"><a href="stis.html#cb56-14" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">55</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">59</span> <span class="sc">~</span> <span class="st">&quot;55 to 59 years&quot;</span>,</span>
<span id="cb56-15"><a href="stis.html#cb56-15" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">64</span> <span class="sc">~</span> <span class="st">&quot;60 to 64 years&quot;</span>,</span>
<span id="cb56-16"><a href="stis.html#cb56-16" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">65</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">74</span> <span class="sc">~</span> <span class="st">&quot;65 to 74 years&quot;</span>,</span>
<span id="cb56-17"><a href="stis.html#cb56-17" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">75</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">84</span> <span class="sc">~</span> <span class="st">&quot;75 to 84 years&quot;</span>,</span>
<span id="cb56-18"><a href="stis.html#cb56-18" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">85</span> <span class="sc">~</span> <span class="st">&quot;85 years and over&quot;</span></span>
<span id="cb56-19"><a href="stis.html#cb56-19" tabindex="-1"></a>      ),</span>
<span id="cb56-20"><a href="stis.html#cb56-20" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Under 5 years&quot;</span>, <span class="st">&quot;5 to 9 years&quot;</span>, <span class="st">&quot;10 to 14 years&quot;</span>, <span class="st">&quot;15 to 19 years&quot;</span>,</span>
<span id="cb56-21"><a href="stis.html#cb56-21" tabindex="-1"></a>                <span class="st">&quot;20 to 24 years&quot;</span>, <span class="st">&quot;25 to 34 years&quot;</span>, <span class="st">&quot;35 to 44 years&quot;</span>,</span>
<span id="cb56-22"><a href="stis.html#cb56-22" tabindex="-1"></a>                <span class="st">&quot;45 to 54 years&quot;</span>, <span class="st">&quot;55 to 59 years&quot;</span>, <span class="st">&quot;60 to 64 years&quot;</span>,</span>
<span id="cb56-23"><a href="stis.html#cb56-23" tabindex="-1"></a>                <span class="st">&quot;65 to 74 years&quot;</span>, <span class="st">&quot;75 to 84 years&quot;</span>)</span>
<span id="cb56-24"><a href="stis.html#cb56-24" tabindex="-1"></a>    ),</span>
<span id="cb56-25"><a href="stis.html#cb56-25" tabindex="-1"></a>    <span class="at">age_6 =</span> <span class="fu">case_when</span>(</span>
<span id="cb56-26"><a href="stis.html#cb56-26" tabindex="-1"></a>        Age <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">&quot;Under 5 years&quot;</span>,</span>
<span id="cb56-27"><a href="stis.html#cb56-27" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;</span> <span class="dv">18</span> <span class="sc">~</span> <span class="st">&quot;5 to 17 years&quot;</span>,</span>
<span id="cb56-28"><a href="stis.html#cb56-28" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;</span> <span class="dv">25</span> <span class="sc">~</span> <span class="st">&quot;18 to 24 years&quot;</span>,</span>
<span id="cb56-29"><a href="stis.html#cb56-29" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;</span> <span class="dv">45</span> <span class="sc">~</span> <span class="st">&quot;25 to 44 years&quot;</span>,</span>
<span id="cb56-30"><a href="stis.html#cb56-30" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">45</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;</span> <span class="dv">65</span> <span class="sc">~</span> <span class="st">&quot;45 to 64 years&quot;</span>,</span>
<span id="cb56-31"><a href="stis.html#cb56-31" tabindex="-1"></a>        Age <span class="sc">&gt;=</span> <span class="dv">65</span> <span class="sc">~</span> <span class="st">&quot;65 years and over&quot;</span></span>
<span id="cb56-32"><a href="stis.html#cb56-32" tabindex="-1"></a>    ),</span>
<span id="cb56-33"><a href="stis.html#cb56-33" tabindex="-1"></a>    <span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">MMWR Date</span><span class="st">`</span>)</span>
<span id="cb56-34"><a href="stis.html#cb56-34" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb56-35"><a href="stis.html#cb56-35" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, age_6) <span class="sc">%&gt;%</span> </span>
<span id="cb56-36"><a href="stis.html#cb56-36" tabindex="-1"></a>  <span class="fu">tally</span>(<span class="at">name =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-37"><a href="stis.html#cb56-37" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">fill =</span> <span class="fu">list</span>(<span class="at">Count =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-38"><a href="stis.html#cb56-38" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(age_6)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-39"><a href="stis.html#cb56-39" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb56-40"><a href="stis.html#cb56-40" tabindex="-1"></a>    census_age,</span>
<span id="cb56-41"><a href="stis.html#cb56-41" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">join_by</span>(age_6 <span class="sc">==</span> Label, Year)</span>
<span id="cb56-42"><a href="stis.html#cb56-42" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb56-43"><a href="stis.html#cb56-43" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&quot;Incidence&quot;</span> <span class="ot">=</span> Count <span class="sc">/</span> Population <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb56-44"><a href="stis.html#cb56-44" tabindex="-1"></a>         <span class="st">&quot;age_6&quot;</span> <span class="ot">=</span> <span class="fu">factor</span>(</span>
<span id="cb56-45"><a href="stis.html#cb56-45" tabindex="-1"></a>           <span class="at">x =</span> age_6,</span>
<span id="cb56-46"><a href="stis.html#cb56-46" tabindex="-1"></a>           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Under 5 years&quot;</span>, <span class="st">&quot;5 to 17 years&quot;</span>, <span class="st">&quot;18 to 24 years&quot;</span>,</span>
<span id="cb56-47"><a href="stis.html#cb56-47" tabindex="-1"></a>                      <span class="st">&quot;25 to 44 years&quot;</span>, <span class="st">&quot;45 to 64 years&quot;</span>, <span class="st">&quot;65 years and over&quot;</span>)</span>
<span id="cb56-48"><a href="stis.html#cb56-48" tabindex="-1"></a>         ))</span>
<span id="cb56-49"><a href="stis.html#cb56-49" tabindex="-1"></a></span>
<span id="cb56-50"><a href="stis.html#cb56-50" tabindex="-1"></a>gono_race <span class="ot">&lt;-</span> gono_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb56-51"><a href="stis.html#cb56-51" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-52"><a href="stis.html#cb56-52" tabindex="-1"></a>    <span class="st">&quot;race_5&quot;</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb56-53"><a href="stis.html#cb56-53" tabindex="-1"></a>        Race <span class="sc">==</span> <span class="st">&quot;White&quot;</span> <span class="sc">~</span> <span class="st">&quot;White&quot;</span>,</span>
<span id="cb56-54"><a href="stis.html#cb56-54" tabindex="-1"></a>        Race <span class="sc">==</span> <span class="st">&quot;Black or African American&quot;</span> <span class="sc">~</span> <span class="st">&quot;Black or African American&quot;</span>,</span>
<span id="cb56-55"><a href="stis.html#cb56-55" tabindex="-1"></a>        Race <span class="sc">==</span> <span class="st">&quot;Asian&quot;</span> <span class="sc">~</span> <span class="st">&quot;Asian&quot;</span>,</span>
<span id="cb56-56"><a href="stis.html#cb56-56" tabindex="-1"></a>        <span class="fu">str_detect</span>(Race, <span class="st">&quot;,&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Two or more races&quot;</span>,</span>
<span id="cb56-57"><a href="stis.html#cb56-57" tabindex="-1"></a>        Race <span class="sc">==</span> <span class="st">&quot;Unknown&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(Race) <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb56-58"><a href="stis.html#cb56-58" tabindex="-1"></a>        <span class="at">.default =</span> <span class="st">&quot;Some other race&quot;</span></span>
<span id="cb56-59"><a href="stis.html#cb56-59" tabindex="-1"></a>    ),</span>
<span id="cb56-60"><a href="stis.html#cb56-60" tabindex="-1"></a>    <span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">MMWR Date</span><span class="st">`</span>)</span>
<span id="cb56-61"><a href="stis.html#cb56-61" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb56-62"><a href="stis.html#cb56-62" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, race_5) <span class="sc">%&gt;%</span> </span>
<span id="cb56-63"><a href="stis.html#cb56-63" tabindex="-1"></a>  <span class="fu">tally</span>(<span class="at">name =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-64"><a href="stis.html#cb56-64" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">fill =</span> <span class="fu">list</span>(<span class="at">Count =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-65"><a href="stis.html#cb56-65" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(race_5)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-66"><a href="stis.html#cb56-66" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb56-67"><a href="stis.html#cb56-67" tabindex="-1"></a>    census_raceth,</span>
<span id="cb56-68"><a href="stis.html#cb56-68" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">join_by</span>(race_5 <span class="sc">==</span> Label, Year)</span>
<span id="cb56-69"><a href="stis.html#cb56-69" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb56-70"><a href="stis.html#cb56-70" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&quot;Incidence&quot;</span> <span class="ot">=</span> Count <span class="sc">/</span> Population <span class="sc">*</span> <span class="dv">100000</span>,</span>
<span id="cb56-71"><a href="stis.html#cb56-71" tabindex="-1"></a>         <span class="st">&quot;race_5&quot;</span> <span class="ot">=</span> <span class="fu">factor</span>(</span>
<span id="cb56-72"><a href="stis.html#cb56-72" tabindex="-1"></a>           <span class="at">x =</span> race_5,</span>
<span id="cb56-73"><a href="stis.html#cb56-73" tabindex="-1"></a>           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Asian&quot;</span>, <span class="st">&quot;Black or African American&quot;</span>, <span class="st">&quot;White&quot;</span>,</span>
<span id="cb56-74"><a href="stis.html#cb56-74" tabindex="-1"></a>                      <span class="st">&quot;Some other race&quot;</span>, <span class="st">&quot;Two or more races&quot;</span>)</span>
<span id="cb56-75"><a href="stis.html#cb56-75" tabindex="-1"></a>         ))</span>
<span id="cb56-76"><a href="stis.html#cb56-76" tabindex="-1"></a></span>
<span id="cb56-77"><a href="stis.html#cb56-77" tabindex="-1"></a>gono_city <span class="ot">&lt;-</span> gono_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb56-78"><a href="stis.html#cb56-78" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">MMWR Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-79"><a href="stis.html#cb56-79" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, City_guess) <span class="sc">%&gt;%</span> </span>
<span id="cb56-80"><a href="stis.html#cb56-80" tabindex="-1"></a>  <span class="fu">tally</span>(<span class="at">name =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-81"><a href="stis.html#cb56-81" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">fill =</span> <span class="fu">list</span>(<span class="at">Count =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-82"><a href="stis.html#cb56-82" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(City_guess)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-83"><a href="stis.html#cb56-83" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-84"><a href="stis.html#cb56-84" tabindex="-1"></a>    <span class="st">&quot;Count&quot;</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb56-85"><a href="stis.html#cb56-85" tabindex="-1"></a>      Count <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb56-86"><a href="stis.html#cb56-86" tabindex="-1"></a>      <span class="at">.default =</span> Count</span>
<span id="cb56-87"><a href="stis.html#cb56-87" tabindex="-1"></a>    )</span>
<span id="cb56-88"><a href="stis.html#cb56-88" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="graphing-gonorrhea-incidence-by-age-group" class="section level3 hasAnchor" number="3.7.4">
<h3><span class="header-section-number">3.7.4</span> Graphing gonorrhea incidence by age group<a href="stis.html#graphing-gonorrhea-incidence-by-age-group" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="stis.html#cb57-1" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb57-2"><a href="stis.html#cb57-2" tabindex="-1"></a>  gono_age,</span>
<span id="cb57-3"><a href="stis.html#cb57-3" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> age_6, <span class="at">y =</span> Incidence, <span class="at">fill =</span> <span class="fu">as.character</span>(Year))</span>
<span id="cb57-4"><a href="stis.html#cb57-4" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb57-5"><a href="stis.html#cb57-5" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb57-6"><a href="stis.html#cb57-6" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set2&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-7"><a href="stis.html#cb57-7" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb57-8"><a href="stis.html#cb57-8" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age group&quot;</span>,</span>
<span id="cb57-9"><a href="stis.html#cb57-9" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Cases per 100k population&quot;</span>,</span>
<span id="cb57-10"><a href="stis.html#cb57-10" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Year&quot;</span></span>
<span id="cb57-11"><a href="stis.html#cb57-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-12"><a href="stis.html#cb57-12" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb57-13"><a href="stis.html#cb57-13" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Gonorrhea Incidence by Age Group in Wake County, 2019-2023&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-14"><a href="stis.html#cb57-14" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-15"><a href="stis.html#cb57-15" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb57-16"><a href="stis.html#cb57-16" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb57-17"><a href="stis.html#cb57-17" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/gono%20age-1.png" width="672" /></p>
</div>
<div id="graphing-gonorrhea-incidence-by-race" class="section level3 hasAnchor" number="3.7.5">
<h3><span class="header-section-number">3.7.5</span> Graphing gonorrhea incidence by race<a href="stis.html#graphing-gonorrhea-incidence-by-race" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="stis.html#cb58-1" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb58-2"><a href="stis.html#cb58-2" tabindex="-1"></a>  gono_race,</span>
<span id="cb58-3"><a href="stis.html#cb58-3" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> race_5, <span class="at">y =</span> Incidence, <span class="at">fill =</span> <span class="fu">as.character</span>(Year))</span>
<span id="cb58-4"><a href="stis.html#cb58-4" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb58-5"><a href="stis.html#cb58-5" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb58-6"><a href="stis.html#cb58-6" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set2&quot;</span>) <span class="sc">+</span></span>
<span id="cb58-7"><a href="stis.html#cb58-7" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb58-8"><a href="stis.html#cb58-8" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Race&quot;</span>,</span>
<span id="cb58-9"><a href="stis.html#cb58-9" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Cases per 100k population&quot;</span>,</span>
<span id="cb58-10"><a href="stis.html#cb58-10" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Year&quot;</span></span>
<span id="cb58-11"><a href="stis.html#cb58-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb58-12"><a href="stis.html#cb58-12" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb58-13"><a href="stis.html#cb58-13" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Gonorrhea Incidence by Race in Wake County, 2019-2023&quot;</span>) <span class="sc">+</span></span>
<span id="cb58-14"><a href="stis.html#cb58-14" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb58-15"><a href="stis.html#cb58-15" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb58-16"><a href="stis.html#cb58-16" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb58-17"><a href="stis.html#cb58-17" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/gono%20race-1.png" width="672" /></p>
</div>
<div id="graphing-gonorrhea-count-by-municipality" class="section level3 hasAnchor" number="3.7.6">
<h3><span class="header-section-number">3.7.6</span> Graphing gonorrhea count by municipality<a href="stis.html#graphing-gonorrhea-count-by-municipality" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="stis.html#cb59-1" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb59-2"><a href="stis.html#cb59-2" tabindex="-1"></a>  gono_city,</span>
<span id="cb59-3"><a href="stis.html#cb59-3" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb59-4"><a href="stis.html#cb59-4" tabindex="-1"></a>    <span class="at">x =</span> Count,</span>
<span id="cb59-5"><a href="stis.html#cb59-5" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">fct_rev</span>(City_guess),</span>
<span id="cb59-6"><a href="stis.html#cb59-6" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">fct_rev</span>(<span class="fu">as.factor</span>(Year))</span>
<span id="cb59-7"><a href="stis.html#cb59-7" tabindex="-1"></a>  )</span>
<span id="cb59-8"><a href="stis.html#cb59-8" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb59-9"><a href="stis.html#cb59-9" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb59-10"><a href="stis.html#cb59-10" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb59-11"><a href="stis.html#cb59-11" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Cases&quot;</span>,</span>
<span id="cb59-12"><a href="stis.html#cb59-12" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Municipality&quot;</span>,</span>
<span id="cb59-13"><a href="stis.html#cb59-13" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Year&quot;</span></span>
<span id="cb59-14"><a href="stis.html#cb59-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb59-15"><a href="stis.html#cb59-15" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set2&quot;</span>, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb59-16"><a href="stis.html#cb59-16" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb59-17"><a href="stis.html#cb59-17" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Gonorrhea Count by Municipality in Wake County, 2019-2023&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-18"><a href="stis.html#cb59-18" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb59-19"><a href="stis.html#cb59-19" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb59-20"><a href="stis.html#cb59-20" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb59-21"><a href="stis.html#cb59-21" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/gono%20city-1.png" width="672" /></p>
</div>
</div>
<div id="final-notes-2" class="section level2 hasAnchor" number="3.8">
<h2><span class="header-section-number">3.8</span> Final notes<a href="stis.html#final-notes-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This analysis produced six graphs, which give useful information for conclusions.</p>
<ol style="list-style-type: decimal">
<li>Risk of chlamydia and gonorrhea is highest by far for residents aged 18 to 24.</li>
<li>Though there is discussion of high nursing home transmission of STIs, case data from 2019 to 2023 do not demonstrate a concern in the 65 years and over age group.</li>
<li>Black and African American residents are at higher risk for chlamydia and gonorrhea, and both appear to be sharply increasing. White, Asian, and multiracial residents appear to be at low risk, while residents of other races (including American Indian/Alaska Native and Native Hawaiian/Pacific Islander) are at elevated risk.</li>
<li>Raleigh accounts for most STI cases, and its cases are rising. Cases in most other municipalities are not trending in any particular direction, with some seeing a slight increase.</li>
</ol>
<p>This kind of analysis can be very illustrative, and it would likely benefit other Wake County programs. R makes the process of analyzing line list data in this way much faster and repeatable.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>The American Community Survey (ACS) is a survey tool from the United States Census Bureau. For 2018, 2019, 2021, and 2022, table <a href="https://data.census.gov/table/ACSDP1Y2022.DP05?q=acs%20population">DP05 (ACS Demographic and Housing Estimates)</a> was used.<a href="stis.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>The Decennial Census is performed every ten years by the United States Census Bureau. For 2020, table <a href="https://data.census.gov/table/DECENNIALDP2020.DP1?q=dp1&amp;g=050XX00US37183">DP1 (Profile of General Population and Housing Characteristics)</a> was used.<a href="stis.html#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mch-report.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="respiratory-viruses.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
